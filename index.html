<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#C8102E">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¥</text></svg>">
<title>Kolonoskopim â€” HazÄ±rlÄ±k Rehberi</title>
<style>
:root{--bx:#C8102E;--bx-l:rgba(200,16,46,.08);--bx-m:rgba(200,16,46,.15);--dark:#1a1a1a;--body:#444;--muted:#999;--light:#f5f4f2;--card:#fff;--border:#e8e6e3;--green:#1a8d4e;--green-l:rgba(26,141,78,.08);--orange:#e67e22;--orange-l:rgba(230,126,34,.08);--red:#c0392b;--red-l:rgba(192,57,43,.08);--sans:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;--r:16px;--sh:0 2px 16px rgba(0,0,0,.06)}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-text-size-adjust:100%;scroll-behavior:smooth}
body{font-family:var(--sans);color:var(--body);background:var(--light);line-height:1.5;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
.scr{display:none;min-height:100dvh;padding-bottom:100px}.scr.on{display:block;animation:up .35s ease}
@keyframes up{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* WIZARD */
.wiz{min-height:100dvh;display:flex;flex-direction:column;justify-content:center;padding:32px 24px;text-align:center}
.wiz-step{display:none}.wiz-step.on{display:block;animation:up .3s ease}
.wiz-emoji{font-size:64px;margin-bottom:16px}
.wiz h2{font-size:26px;font-weight:700;color:var(--dark);line-height:1.3;margin-bottom:8px}
.wiz p.wiz-sub{font-size:16px;color:var(--muted);margin-bottom:28px;line-height:1.5}
.wiz-input{width:100%;padding:18px 20px;border:2px solid var(--border);border-radius:14px;font-size:20px;font-family:var(--sans);color:var(--dark);background:var(--card);text-align:center;appearance:none;-webkit-appearance:none}
.wiz-input:focus{outline:none;border-color:var(--bx)}
.opts{display:flex;flex-direction:column;gap:12px;max-width:360px;margin:0 auto}
.opt{display:flex;align-items:center;gap:16px;padding:20px;border:2.5px solid var(--border);border-radius:16px;background:var(--card);cursor:pointer;transition:all .2s;text-align:left}
.opt:active{transform:scale(.98)}.opt.sel{border-color:var(--bx);background:var(--bx-l)}
.opt-ico{font-size:36px;flex-shrink:0;width:48px;text-align:center}
.opt-body h3{font-size:17px;font-weight:700;color:var(--dark)}.opt-body p{font-size:13px;color:var(--muted);margin-top:2px}
.opts2{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:360px;margin:0 auto}
.opt2{display:flex;flex-direction:column;align-items:center;gap:8px;padding:24px 16px;border:2.5px solid var(--border);border-radius:16px;background:var(--card);cursor:pointer;transition:all .2s;text-align:center}
.opt2:active{transform:scale(.97)}.opt2.sel{border-color:var(--bx);background:var(--bx-l)}
.opt2 .o2-ico{font-size:40px}.opt2 h3{font-size:16px;font-weight:700;color:var(--dark)}.opt2 p{font-size:12px;color:var(--muted)}
.btn{display:block;width:100%;max-width:360px;margin:24px auto 0;padding:18px;border:none;border-radius:14px;font-size:18px;font-weight:700;font-family:var(--sans);cursor:pointer;transition:all .15s;letter-spacing:.3px}
.btn:active{transform:scale(.97)}.btn-primary{background:var(--bx);color:#fff}.btn-primary:disabled{opacity:.3;cursor:not-allowed;transform:none}
.btn-ghost{background:none;color:var(--muted);font-size:14px;font-weight:500;margin-top:12px}

/* NAV */
.nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:8px 0 env(safe-area-inset-bottom,10px);z-index:200;display:none}
.nav.on{display:block}
.nav-in{max-width:440px;margin:0 auto;display:flex;justify-content:space-around}
.nb{display:flex;flex-direction:column;align-items:center;gap:3px;border:none;background:none;cursor:pointer;padding:6px 8px;color:var(--muted);font-size:11px;font-weight:600;font-family:var(--sans);transition:color .2s;min-width:56px}
.nb .ni{font-size:24px;line-height:1;transition:transform .2s}.nb.on{color:var(--bx)}.nb.on .ni{transform:scale(1.15)}

.box{max-width:440px;margin:0 auto;padding:0 20px}

/* HERO */
.hero{background:var(--dark);color:#fff;border-radius:var(--r);padding:28px 24px;margin:20px 0 16px;text-align:center;position:relative;overflow:hidden}
.hero::after{content:'';position:absolute;top:-40px;right:-40px;width:140px;height:140px;border-radius:50%;background:rgba(200,16,46,.12)}
.hero-label{font-size:12px;text-transform:uppercase;letter-spacing:2.5px;color:rgba(255,255,255,.45);margin-bottom:8px;font-weight:600}
.hero-big{font-size:72px;font-weight:700;line-height:1;letter-spacing:-3px}
.hero-unit{font-size:22px;color:var(--bx);font-weight:600;margin-left:2px}
.hero-detail{font-size:14px;color:rgba(255,255,255,.55);margin-top:8px}

/* PHASE */
.phase{border-radius:var(--r);padding:20px;margin:12px 0;position:relative;overflow:hidden}
.phase.green{background:var(--green-l);border-left:4px solid var(--green)}
.phase.orange{background:var(--orange-l);border-left:4px solid var(--orange)}
.phase.bx{background:var(--bx-l);border-left:4px solid var(--bx)}
.phase-tag{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px}
.phase.green .phase-tag{color:var(--green)}.phase.orange .phase-tag{color:var(--orange)}.phase.bx .phase-tag{color:var(--bx)}
.phase-title{font-size:20px;font-weight:700;color:var(--dark);margin-bottom:4px}
.phase-desc{font-size:14px;color:var(--body);line-height:1.5}

.prog{margin:16px 0 8px}.prog-bar{background:var(--border);border-radius:8px;height:8px;overflow:hidden}
.prog-fill{height:100%;background:var(--bx);border-radius:8px;transition:width .6s ease}
.prog-labels{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px;font-weight:500}

/* TASKS */
.tasks{margin:16px 0}.tasks-head{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--bx);margin-bottom:12px}
.task{display:flex;align-items:flex-start;gap:14px;background:var(--card);border-radius:14px;padding:16px;margin:8px 0;box-shadow:var(--sh);cursor:pointer;transition:all .2s}
.task:active{transform:scale(.99)}
.tck{width:28px;height:28px;border:2.5px solid var(--border);border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:16px;margin-top:1px}
.task.done .tck{background:var(--green);border-color:var(--green);color:#fff}.task.done{opacity:.6}
.t-body{flex:1}.t-body h4{font-size:16px;font-weight:600;color:var(--dark);line-height:1.3}.t-body p{font-size:13px;color:var(--muted);margin-top:3px;line-height:1.4}
.t-time{font-size:13px;font-weight:700;color:var(--bx);white-space:nowrap;margin-top:2px}

/* DIET â€” Day tabs */
.dtabs{display:flex;gap:8px;padding:20px 0 12px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.dtabs::-webkit-scrollbar{display:none}
.dtab{flex-shrink:0;padding:12px 20px;border-radius:24px;border:2px solid var(--border);background:var(--card);font-size:14px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .2s;white-space:nowrap}
.dtab.on{background:var(--bx);border-color:var(--bx);color:#fff}

/* DIET â€” Day header */
.day-hero{background:var(--card);border-radius:var(--r);padding:20px;margin:8px 0;box-shadow:var(--sh);text-align:center}
.day-hero .dh-ico{font-size:40px;margin-bottom:8px}
.day-hero h2{font-size:20px;font-weight:700;color:var(--dark);margin-bottom:4px}
.day-hero p{font-size:14px;color:var(--muted);line-height:1.5}
.day-hero .dh-rule{display:inline-block;margin-top:10px;padding:8px 16px;background:var(--bx-l);border-radius:10px;font-size:14px;font-weight:600;color:var(--bx)}

/* DIET â€” Hydration tracker */
.hydro{background:var(--card);border-radius:var(--r);padding:20px;margin:10px 0;box-shadow:var(--sh)}
.hydro-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.hydro-head h3{font-size:15px;font-weight:700;color:var(--dark)}
.hydro-head span{font-size:14px;font-weight:600;color:var(--bx)}
.hydro-bar{background:var(--border);border-radius:8px;height:10px;overflow:hidden;margin-bottom:10px}
.hydro-fill{height:100%;background:linear-gradient(90deg,#4FC3F7,#0288D1);border-radius:8px;transition:width .4s ease}
.glasses{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
.glass{width:40px;height:40px;border-radius:10px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;transition:all .2s;background:var(--card)}
.glass.full{background:#E1F5FE;border-color:#4FC3F7}
.glass:active{transform:scale(.9)}

/* DIET â€” Search */
.diet-search{position:relative;margin:10px 0}
.diet-search input{width:100%;padding:16px 16px 16px 48px;border:2px solid var(--border);border-radius:14px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--card)}
.diet-search input:focus{outline:none;border-color:var(--bx)}
.diet-search input::placeholder{color:var(--muted)}
.diet-search .ds-ico{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:20px}
.search-results{margin:8px 0}
.sr-item{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--card);border-radius:12px;margin:6px 0;box-shadow:var(--sh)}
.sr-item .sr-name{font-size:15px;font-weight:600;color:var(--dark)}
.sr-item .sr-cat{font-size:12px;color:var(--muted)}
.sr-badge{padding:6px 12px;border-radius:8px;font-size:13px;font-weight:700}
.sr-badge.yes{background:var(--green-l);color:var(--green)}
.sr-badge.no{background:var(--red-l);color:var(--red)}
.sr-badge.maybe{background:var(--orange-l);color:var(--orange)}
.sr-empty{text-align:center;padding:20px;color:var(--muted);font-size:14px}

/* DIET â€” Meal timeline */
.meal-tl{margin:16px 0}
.meal-tl-head{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--bx);margin-bottom:10px}
.meal-card{background:var(--card);border-radius:14px;padding:16px;margin:8px 0;box-shadow:var(--sh);display:flex;gap:14px;align-items:flex-start}
.meal-card .mc-time{min-width:56px;text-align:center;flex-shrink:0}
.meal-card .mc-time .mt-hour{font-size:16px;font-weight:700;color:var(--dark)}
.meal-card .mc-time .mt-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--bx)}
.meal-card .mc-body{flex:1;border-left:2px solid var(--border);padding-left:14px}
.meal-card .mc-body h4{font-size:15px;font-weight:600;color:var(--dark);margin-bottom:4px}
.meal-card .mc-body p{font-size:13px;color:var(--muted);line-height:1.5}
.meal-card .mc-body .mc-items{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.mc-chip{display:inline-flex;align-items:center;gap:4px;padding:6px 10px;border-radius:8px;font-size:12px;font-weight:500;background:var(--green-l);color:var(--green)}

/* DIET â€” Category accordions */
.cat-section{margin:16px 0}
.cat-section .cs-head{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--bx);margin-bottom:10px}
.acc{background:var(--card);border-radius:14px;margin:6px 0;box-shadow:var(--sh);overflow:hidden}
.acc-head{display:flex;align-items:center;gap:12px;padding:16px;cursor:pointer;transition:background .2s}
.acc-head:active{background:var(--light)}
.acc-head .ah-ico{font-size:24px;flex-shrink:0}
.acc-head h4{font-size:15px;font-weight:600;color:var(--dark);flex:1}
.acc-head .ah-arrow{font-size:16px;color:var(--muted);transition:transform .3s}
.acc.open .ah-arrow{transform:rotate(180deg)}
.acc-body{max-height:0;overflow:hidden;transition:max-height .35s ease}
.acc.open .acc-body{max-height:2000px}
.acc-inner{padding:0 16px 16px}
.fi{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;font-size:14px;font-weight:500;margin:3px 0}
.fi.yes{background:var(--green-l);color:var(--green)}.fi.no{background:var(--red-l);color:var(--red);text-decoration:line-through;opacity:.7}
.fi.maybe{background:var(--orange-l);color:var(--orange)}
.fi-m{font-size:16px;flex-shrink:0;width:22px;text-align:center}

/* DRUG */
.drug-head{background:var(--card);border-radius:var(--r);padding:20px;margin:20px 0 12px;box-shadow:var(--sh);display:flex;align-items:center;gap:16px}
.drug-head .dh-ico{font-size:44px}.drug-head h3{font-size:18px;font-weight:700;color:var(--dark)}.drug-head p{font-size:13px;color:var(--muted);margin-top:2px}
.timeline{position:relative;padding-left:32px;margin:8px 0}.timeline::before{content:'';position:absolute;left:12px;top:0;bottom:0;width:2px;background:var(--border)}
.tl-item{position:relative;margin:16px 0}
.tl-dot{position:absolute;left:-32px;top:2px;width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;z-index:1}
.tl-dot.bx{background:var(--bx)}.tl-dot.red{background:var(--red)}
.tl-card{background:var(--card);border-radius:14px;padding:18px;box-shadow:var(--sh)}
.tl-time{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--bx);margin-bottom:4px}
.tl-title{font-size:17px;font-weight:700;color:var(--dark);margin-bottom:4px}.tl-desc{font-size:14px;color:var(--body);line-height:1.5}
.tl-tip{margin-top:10px;padding:10px 14px;background:var(--bx-l);border-radius:10px;font-size:13px;color:var(--bx);font-weight:500}
.stop-bar{background:var(--red);color:#fff;border-radius:14px;padding:20px;margin:16px 0;text-align:center;font-size:18px;font-weight:700}
.stop-bar small{display:block;font-size:13px;font-weight:400;margin-top:4px;opacity:.85}
.info-card{background:var(--bx-l);border-radius:14px;padding:16px 18px;margin:10px 0;border-left:4px solid var(--bx)}
.info-card h4{font-size:13px;font-weight:700;color:var(--bx);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.info-card p{font-size:14px;color:var(--body);line-height:1.5}
.tips-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0}
.tip-card{background:var(--card);border-radius:14px;padding:16px;text-align:center;box-shadow:var(--sh)}
.tip-card .tc-ico{font-size:32px;margin-bottom:6px}.tip-card p{font-size:13px;color:var(--body);line-height:1.4;font-weight:500}

/* STOOL */
.stool-head{text-align:center;padding:24px 0 8px}.stool-head h2{font-size:22px;font-weight:700;color:var(--dark)}.stool-head p{font-size:15px;color:var(--muted);margin-top:4px}
.stools{display:flex;flex-direction:column;gap:10px;margin:16px 0}
.si{display:flex;align-items:center;gap:16px;background:var(--card);border-radius:16px;padding:18px;box-shadow:var(--sh);cursor:pointer;border:2.5px solid transparent;transition:all .2s;position:relative}
.si:active{transform:scale(.98)}.si.sel{border-color:var(--bx);background:var(--bx-l)}
.si-dot{width:48px;height:48px;border-radius:50%;flex-shrink:0}
.si-body h4{font-size:16px;font-weight:600;color:var(--dark)}.si-body p{font-size:13px;color:var(--muted);margin-top:2px}
.si-target{position:absolute;right:16px;font-size:10px;font-weight:700;letter-spacing:1px;color:var(--bx)}
.sfb{background:var(--card);border-radius:var(--r);padding:28px 24px;margin:16px 0;box-shadow:var(--sh);text-align:center;display:none}
.sfb.on{display:block;animation:up .3s ease}
.sfb-emoji{font-size:56px;margin-bottom:10px}.sfb-msg{font-size:20px;font-weight:700;color:var(--dark)}.sfb-detail{font-size:14px;color:var(--muted);margin-top:8px;line-height:1.6}

/* CHECKLIST */
.cl-progress{text-align:center;padding:20px 0 8px}
.cl-ring{display:inline-block;width:80px;height:80px;border-radius:50%;position:relative;margin-bottom:8px}
.cl-ring::after{content:attr(data-pct);position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;color:var(--dark)}
.cl-progress p{font-size:14px;color:var(--muted);font-weight:500}
.cl-card{background:var(--card);border-radius:var(--r);padding:8px;margin:12px 0;box-shadow:var(--sh)}
.cli{display:flex;align-items:center;gap:14px;padding:16px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:all .15s}
.cli:last-child{border-bottom:none}.cli:active{background:var(--light)}
.cl-box{width:28px;height:28px;border:2.5px solid var(--border);border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:16px}
.cli.chk .cl-box{background:var(--green);border-color:var(--green);color:#fff}
.cl-txt{font-size:15px;color:var(--dark);font-weight:500;flex:1}.cli.chk .cl-txt{color:var(--muted);text-decoration:line-through}
.warn{background:linear-gradient(135deg,#8B2500,#c0392b);color:#fff;border-radius:var(--r);padding:20px;margin:16px 0}
.warn h3{font-size:16px;font-weight:700;margin-bottom:6px}.warn p{font-size:14px;line-height:1.6;opacity:.9}.warn strong{opacity:1}
.emerg{background:var(--card);border:2.5px solid var(--red);border-radius:var(--r);padding:20px;margin:16px 0}
.emerg h3{color:var(--red);font-size:16px;font-weight:700;margin-bottom:10px}
.emerg li{padding:6px 0;font-size:15px;color:var(--body);list-style:none}.emerg li::before{content:"âš ï¸ ";margin-right:4px}
.emer-btn{display:block;width:100%;padding:18px;margin-top:16px;background:var(--red);color:#fff;border:none;border-radius:14px;font-size:18px;font-weight:700;cursor:pointer;text-align:center;text-decoration:none;font-family:var(--sans)}
.med{background:var(--card);border-radius:var(--r);padding:18px;margin:8px 0;box-shadow:var(--sh)}
.med h4{font-size:15px;font-weight:700;color:var(--dark);margin-bottom:4px;display:flex;align-items:center;gap:8px}
.med p{font-size:14px;color:var(--muted);line-height:1.5}
.foot{text-align:center;padding:32px 16px 16px;font-size:12px;color:var(--muted)}.foot strong{color:var(--dark)}
.reset-wrap{text-align:center;margin:24px 0}.reset-btn{background:none;border:1.5px solid var(--border);border-radius:10px;padding:10px 20px;font-size:13px;color:var(--muted);cursor:pointer;font-family:var(--sans)}

/* LOGIN */
.login{min-height:100dvh;display:flex;flex-direction:column;justify-content:center;padding:32px 24px;text-align:center}
.login-brand{font-size:12px;text-transform:uppercase;letter-spacing:3px;color:var(--bx);font-weight:700;margin-bottom:8px}
.login h1{font-size:28px;font-weight:700;color:var(--dark);margin-bottom:4px}
.login .login-sub{font-size:15px;color:var(--muted);margin-bottom:32px}
.login-card{background:var(--card);border-radius:var(--r);padding:24px;box-shadow:var(--sh);max-width:360px;margin:0 auto;text-align:left}
.login-card h3{font-size:15px;font-weight:700;color:var(--dark);margin-bottom:16px;text-align:center}
.tc-input{width:100%;padding:18px 20px;border:2px solid var(--border);border-radius:14px;font-size:22px;font-family:var(--sans);color:var(--dark);background:var(--card);text-align:center;letter-spacing:3px;appearance:none;-webkit-appearance:none}
.tc-input:focus{outline:none;border-color:var(--bx)}
.tc-input.error{border-color:var(--red);animation:shake .4s ease}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
.tc-error{color:var(--red);font-size:13px;text-align:center;margin-top:8px;min-height:20px}
.tc-hint{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
.name-input{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--card);margin-top:12px}
.name-input:focus{outline:none;border-color:var(--bx)}
.name-input::placeholder{color:var(--muted)}

.welcome-back{max-width:360px;margin:24px auto 0;background:var(--green-l);border-radius:14px;padding:20px;text-align:center;display:none}
.welcome-back.on{display:block;animation:up .3s ease}
.welcome-back .wb-emoji{font-size:40px;margin-bottom:8px}
.welcome-back h3{font-size:18px;font-weight:700;color:var(--dark)}
.welcome-back p{font-size:14px;color:var(--muted);margin-top:4px}
.welcome-back .wb-info{margin-top:10px;font-size:13px;color:var(--green);font-weight:600}

.privacy-note{max-width:360px;margin:16px auto 0;font-size:11px;color:var(--muted);text-align:center;line-height:1.5}
.privacy-note a{color:var(--bx)}

/* User badge on header */
.user-badge{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);font-weight:500}
.user-badge .ub-dot{width:8px;height:8px;border-radius:50%;background:var(--green)}
.logout-btn{background:none;border:none;color:var(--muted);font-size:12px;cursor:pointer;padding:4px 8px;font-family:var(--sans)}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="scr on">
  <div class="login">
    <div class="login-brand">DoÃ§. Dr. Cem ÅimÅŸek</div>
    <h1>Kolonoskopim</h1>
    <p class="login-sub">HazÄ±rlÄ±k Rehberinize GiriÅŸ YapÄ±n</p>
    <div class="login-card">
      <h3>ğŸ” TC Kimlik NumaranÄ±z</h3>
      <input type="tel" class="tc-input" id="tcInput" maxlength="11" placeholder="_ _ _ _ _ _ _ _ _ _ _" oninput="onTcInput(this)">
      <div class="tc-error" id="tcError"></div>
      <input type="text" class="name-input" id="nameInput" placeholder="AdÄ±nÄ±z (isteÄŸe baÄŸlÄ±)">
      <div class="tc-hint">TC Kimlik numaranÄ±z sadece bu cihazda saklanÄ±r.</div>
      <button class="btn btn-primary" style="margin-top:16px" id="loginBtn" disabled onclick="doLogin()">GiriÅŸ Yap</button>
    </div>
    <div class="welcome-back" id="welcomeBack">
      <div class="wb-emoji">ğŸ‘‹</div>
      <h3 id="wbName">Tekrar hoÅŸ geldiniz!</h3>
      <p>KaldÄ±ÄŸÄ±nÄ±z yerden devam edebilirsiniz.</p>
      <div class="wb-info" id="wbInfo"></div>
      <button class="btn btn-primary" style="margin-top:12px" onclick="continueSession()">Devam Et</button>
      <button class="btn btn-ghost" onclick="newSession()">Yeni hazÄ±rlÄ±k baÅŸlat</button>
    </div>
    <p class="privacy-note">ğŸ”’ Verileriniz yalnÄ±zca bu cihazda saklanÄ±r, hiÃ§bir sunucuya gÃ¶nderilmez. <br>KVKK uyumlu â€” kiÅŸisel verileriniz gÃ¼vendedir.</p>
  </div>
</div>

<!-- WIZARD -->
<div id="wizard" class="scr"><div class="wiz">
  <div class="wiz-step on" id="ws1"><div class="wiz-emoji">ğŸ“…</div><h2>Ä°ÅŸleminiz ne zaman?</h2><p class="wiz-sub">Kolonoskopi tarihinizi seÃ§in</p><input type="date" class="wiz-input" id="wDate"><button class="btn btn-primary" style="margin-top:20px" id="ws1next" disabled onclick="wizNext(2)">Devam â†’</button></div>
  <div class="wiz-step" id="ws2"><div class="wiz-emoji">ğŸ•</div><h2>Sabah mÄ±, Ã¶ÄŸleden sonra mÄ±?</h2><p class="wiz-sub">Ä°ÅŸlem saatinizi seÃ§in</p><div class="opts2"><div class="opt2" onclick="pickTime('morning',this)"><div class="o2-ico">ğŸŒ…</div><h3>Sabah</h3><p>08:00 â€“ 12:00</p></div><div class="opt2" onclick="pickTime('afternoon',this)"><div class="o2-ico">ğŸŒ‡</div><h3>Ã–ÄŸleden Sonra</h3><p>13:00 ve sonrasÄ±</p></div></div><button class="btn btn-primary" id="ws2next" disabled onclick="wizNext(3)">Devam â†’</button><button class="btn btn-ghost" onclick="wizBack(1)">â† Geri</button></div>
  <div class="wiz-step" id="ws3"><div class="wiz-emoji">ğŸ’Š</div><h2>Hangi ilacÄ± kullanacaksÄ±nÄ±z?</h2><p class="wiz-sub">Doktorunuzun reÃ§ete ettiÄŸi ilacÄ± seÃ§in</p><div class="opts"><div class="opt" onclick="pickDrug('peg2',this)"><div class="opt-ico">ğŸŸ¦</div><div class="opt-body"><h3>Pegdin</h3><p>PEG 2 Litre â€” En yaygÄ±n</p></div></div><div class="opt" onclick="pickDrug('picoprep',this)"><div class="opt-ico">ğŸŸ§</div><div class="opt-body"><h3>Picoprep</h3><p>2 SaÅŸe â€” Kolay iÃ§ilir</p></div></div><div class="opt" onclick="pickDrug('fortrans',this)"><div class="opt-ico">ğŸŸª</div><div class="opt-body"><h3>Fortrans</h3><p>PEG 4 Litre â€” Klasik</p></div></div><div class="opt" onclick="pickDrug('phospho',this)"><div class="opt-ico">ğŸŸ©</div><div class="opt-body"><h3>Fleet Fosfo-Soda</h3><p>2 Ã— 45 ml â€” DÃ¼ÅŸÃ¼k hacim</p></div></div></div><button class="btn btn-primary" id="ws3next" disabled onclick="wizNext(4)">Devam â†’</button><button class="btn btn-ghost" onclick="wizBack(2)">â† Geri</button></div>
  <div class="wiz-step" id="ws4"><div class="wiz-emoji">ğŸš€</div><h2>HazÄ±rsÄ±nÄ±z!</h2><p class="wiz-sub">Rehberiniz hazÄ±rlandÄ±. Size adÄ±m adÄ±m yol gÃ¶stereceÄŸiz.</p><button class="btn btn-primary" onclick="startApp()">BaÅŸlayalÄ±m</button><button class="btn btn-ghost" onclick="wizBack(3)">â† Geri</button></div>
</div></div>

<!-- DASHBOARD -->
<div id="home" class="scr"><div class="box">
  <div id="userBar" style="display:flex;justify-content:space-between;align-items:center;padding:16px 0 0">
    <div class="user-badge"><span class="ub-dot"></span><span id="userName"></span></div>
    <button class="logout-btn" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
  <div class="hero"><div class="hero-label">Ä°ÅŸleme Kalan</div><div><span class="hero-big" id="hNum">3</span><span class="hero-unit" id="hUnit">gÃ¼n</span></div><div class="hero-detail" id="hDetail"></div></div>
  <div id="phaseEl"></div>
  <div class="prog"><div class="prog-bar"><div class="prog-fill" id="pFill"></div></div><div class="prog-labels"><span>BaÅŸlangÄ±Ã§</span><span id="pPct"></span><span>Ä°ÅŸlem</span></div></div>
  <div class="tasks"><div class="tasks-head">ğŸ“‹ BugÃ¼nkÃ¼ GÃ¶revler</div><div id="tList"></div></div>
  <div class="reset-wrap"><button class="reset-btn" onclick="resetApp()">âŸ² SÄ±fÄ±rla</button></div>
</div></div>

<!-- DIET -->
<div id="diet" class="scr"><div class="box">
  <div class="dtabs" id="dTabs"></div>
  <div id="dayHero"></div>
  <div id="hydroEl"></div>
  <div class="diet-search"><span class="ds-ico">ğŸ”</span><input type="text" id="searchInput" placeholder="Bu yenilir mi? (Ã¶rn: mercimek)" oninput="doSearch(this.value)"></div>
  <div id="searchRes" class="search-results"></div>
  <div id="mealTL"></div>
  <div id="catAccs"></div>
</div></div>

<!-- DRUG -->
<div id="drug" class="scr"><div class="box" id="drugEl"></div></div>

<!-- STOOL -->
<div id="stool" class="scr"><div class="box">
  <div class="stool-head"><h2>ğŸ“Š NasÄ±l GÃ¶rÃ¼nÃ¼yor?</h2><p>DÄ±ÅŸkÄ±nÄ±zÄ±n gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ seÃ§in</p></div>
  <div class="stools">
    <div class="si" onclick="pickStool(1)"><div class="si-dot" style="background:#3E2723"></div><div class="si-body"><h4>Koyu Kahve â€” KatÄ±</h4><p>HenÃ¼z baÅŸlangÄ±Ã§</p></div></div>
    <div class="si" onclick="pickStool(2)"><div class="si-dot" style="background:#795548"></div><div class="si-body"><h4>Kahverengi â€” BulanÄ±k</h4><p>Ä°laÃ§ etki etmeye baÅŸladÄ±</p></div></div>
    <div class="si" onclick="pickStool(3)"><div class="si-dot" style="background:#BCAAA4"></div><div class="si-body"><h4>AÃ§Ä±k Kahve â€” YarÄ± Berrak</h4><p>Ä°yi ilerliyorsunuz</p></div></div>
    <div class="si" onclick="pickStool(4)"><div class="si-dot" style="background:#FDD835"></div><div class="si-body"><h4>SarÄ±msÄ± â€” Berrak</h4><p>Neredeyse hazÄ±rsÄ±nÄ±z!</p></div><span class="si-target">HEDEF âœ“</span></div>
    <div class="si" onclick="pickStool(5)"><div class="si-dot" style="background:#FFF9C4;border:1px solid #eee"></div><div class="si-body"><h4>Berrak â€” Renksiz</h4><p>MÃ¼kemmel temizlik!</p></div><span class="si-target">HEDEF âœ“</span></div>
  </div>
  <div class="sfb" id="sFb"></div>
</div></div>

<!-- CHECKLIST -->
<div id="check" class="scr"><div class="box">
  <div class="cl-progress"><div class="cl-ring" id="clRing" data-pct="0%"></div><p id="clLabel">0 / 15 tamamlandÄ±</p></div>
  <div class="warn"><h3>âš ï¸ GLP-1 Ä°laÃ§larÄ± â€” Ã‡ok Ã–nemli</h3><p><strong>Ozempic, Wegovy, Mounjaro, Saxenda, Rybelsus, Trulicity</strong> kullanÄ±yorsanÄ±z â€” iÅŸlemden <strong>1â€“2 hafta Ã¶nce kesilmesi</strong> gerekebilir. Mutlaka doktorunuza danÄ±ÅŸÄ±n.</p></div>
  <div class="med"><h4>ğŸ’‰ Kan SulandÄ±rÄ±cÄ±lar</h4><p>Aspirin, Coumadin, Xarelto, Eliquis â€” <strong>mutlaka doktorunuza danÄ±ÅŸÄ±n.</strong></p></div>
  <div class="med"><h4>ğŸ’Š Diyabet Ä°laÃ§larÄ±</h4><p>Ä°nsÃ¼lin doz ayarÄ± gerekir. Metformin iÅŸlem sabahÄ± kesilir.</p></div>
  <div class="med"><h4>ğŸ”´ Demir PreparatlarÄ±</h4><p><strong>5 gÃ¼n Ã¶nce kesin.</strong> DÄ±ÅŸkÄ±yÄ± siyahlaÅŸtÄ±rÄ±r.</p></div>
  <div class="med"><h4>ğŸ’™ Tansiyon Ä°laÃ§larÄ±</h4><p>Ä°ÅŸlem sabahÄ± az su ile alÄ±n (doktor onayÄ±yla).</p></div>
  <div class="cl-card" id="clItems"></div>
  <div class="emerg"><h3>Acil Durumlar â€” Hemen BaÅŸvurun</h3><ul><li>Åiddetli karÄ±n aÄŸrÄ±sÄ±</li><li>38.5Â°C Ã¼zeri ateÅŸ</li><li>Belirgin kanama veya ciddi kusma</li><li>GÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± veya nefes darlÄ±ÄŸÄ±</li></ul><a href="tel:112" class="emer-btn">ğŸš¨ 112'yi Ara</a></div>
  <div class="foot">Doktorunuzun size Ã¶zel talimatlarÄ±na uyunuz.<br><strong>DoÃ§. Dr. Cem ÅimÅŸek</strong> â€” Gastroenteroloji Â· 2025</div>
</div></div>

<!-- NAV -->
<nav class="nav" id="nav"><div class="nav-in">
  <button class="nb on" onclick="go('home')"><span class="ni">ğŸ </span>Ana Sayfa</button>
  <button class="nb" onclick="go('diet')"><span class="ni">ğŸ¥—</span>Diyet</button>
  <button class="nb" onclick="go('drug')"><span class="ni">ğŸ’Š</span>Ä°laÃ§</button>
  <button class="nb" onclick="go('stool')"><span class="ni">ğŸ“Š</span>Takip</button>
  <button class="nb" onclick="go('check')"><span class="ni">âœ…</span>Kontrol</button>
</div></nav>

<script>
let S={date:null,time:null,drug:null,tasks:{},checks:{},stool:null,water:{},name:''};
let userKey=null;
const $=id=>document.getElementById(id);

// TC hash (stays on device only)
async function hashTC(tc){
  const buf=await crypto.subtle.digest('SHA-256',new TextEncoder().encode('kprep_'+tc));
  return 'kp_'+Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('').slice(0,16);
}
function save(){if(userKey)localStorage.setItem(userKey,JSON.stringify(S))}
function load(){try{const s=localStorage.getItem(userKey);if(s)S=JSON.parse(s)}catch(e){}}

// TC validation (resmi algoritma)
function validateTC(tc){
  if(tc.length!==11||tc[0]==='0'||!/^\d{11}$/.test(tc))return false;
  const d=tc.split('').map(Number);
  const c10=((d[0]+d[2]+d[4]+d[6]+d[8])*7-(d[1]+d[3]+d[5]+d[7]))%10;
  if(d[9]!==((c10%10+10)%10))return false;
  return d[10]===(d.slice(0,10).reduce((a,b)=>a+b,0)%10);
}
function onTcInput(el){
  el.value=el.value.replace(/\D/g,'').slice(0,11);
  el.classList.remove('error');$('tcError').textContent='';
  $('loginBtn').disabled=el.value.length!==11;
}
async function doLogin(){
  const tc=$('tcInput').value;
  if(!validateTC(tc)){$('tcInput').classList.add('error');$('tcError').textContent='GeÃ§ersiz TC Kimlik numarasÄ±';return;}
  userKey=await hashTC(tc);
  localStorage.setItem('kp_last',userKey);
  const existing=localStorage.getItem(userKey);
  if(existing){
    try{S=JSON.parse(existing)}catch(e){}
    if(S.date){
      $('wbName').textContent=S.name?'HoÅŸ geldiniz, '+S.name+'!':'Tekrar hoÅŸ geldiniz!';
      const pd=new Date(S.date+'T00:00:00');
      $('wbInfo').textContent='Ä°ÅŸlem: '+pd.toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'});
      $('welcomeBack').classList.add('on');$('loginBtn').style.display='none';
      $('tcInput').closest('.login-card').style.display='none';return;
    }
  }
  S.name=$('nameInput').value.trim();save();goWizard();
}
function continueSession(){$('nav').classList.add('on');document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));go('home')}
function newSession(){S={date:null,time:null,drug:null,tasks:{},checks:{},stool:null,water:{},name:S.name||''};save();goWizard()}
function goWizard(){document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));$('wizard').classList.add('on')}
function logout(){userKey=null;localStorage.removeItem('kp_last');location.reload()}

// â•â•â• FOOD DATABASE â•â•â•
// Format: [name, category, day3, day2, day1] where 1=yes, 0=no, 2=maybe/caution
const FOODS=[
// EKMEK & TAHILLAR
['Beyaz ekmek','Ekmek',1,1,0],['Pide','Ekmek',1,1,0],['Yufka','Ekmek',1,1,0],['Simit','Ekmek',1,0,0],['Bazlama','Ekmek',1,1,0],
['Beyaz pirinÃ§ pilavÄ±','TahÄ±l',1,1,0],['Åehriye','TahÄ±l',1,1,0],['Makarna (sade)','TahÄ±l',1,1,0],['Ä°rmik','TahÄ±l',1,1,0],
['Galeta','TahÄ±l',1,1,0],['Kraker','TahÄ±l',1,1,0],['BiskÃ¼vi (sade)','TahÄ±l',1,1,0],['Grissini','TahÄ±l',1,1,0],
['Tam buÄŸday ekmek','TahÄ±l',0,0,0],['Esmer pirinÃ§','TahÄ±l',0,0,0],['Bulgur','TahÄ±l',0,0,0],['Yulaf','TahÄ±l',0,0,0],
['MÄ±sÄ±r ekmeÄŸi','TahÄ±l',0,0,0],['Ã‡avdar ekmeÄŸi','TahÄ±l',0,0,0],['Kepekli ekmek','TahÄ±l',0,0,0],['Granola','TahÄ±l',0,0,0],['MÃ¼sli','TahÄ±l',0,0,0],

// PROTEÄ°N
['Tavuk gÃ¶ÄŸsÃ¼ (haÅŸlama/Ä±zgara)','Protein',1,1,0],['Tavuk but (derisiz)','Protein',1,1,0],['Hindi eti','Protein',1,1,0],
['Izgara balÄ±k','Protein',1,1,0],['BuÄŸulama balÄ±k','Protein',1,1,0],['Ton balÄ±ÄŸÄ± (konserve)','Protein',1,1,0],
['HaÅŸlama yumurta','Protein',1,1,0],['Omlet (sade)','Protein',1,1,0],['Menemen (sade, posasÄ±z)','Protein',1,0,0],
['YaÄŸsÄ±z kÃ¶fte','Protein',1,0,0],['Dana bonfile','Protein',1,0,0],['Kuzu pirzola','Protein',2,0,0],
['KÄ±rmÄ±zÄ± et (sert/yaÄŸlÄ±)','Protein',0,0,0],['Sucuk','Protein',0,0,0],['PastÄ±rma','Protein',0,0,0],['Salam','Protein',0,0,0],
['Sosis','Protein',0,0,0],['Kavurma','Protein',0,0,0],
['Mercimek','Baklagil',0,0,0],['Nohut','Baklagil',0,0,0],['Kuru fasulye','Baklagil',0,0,0],['Barbunya','Baklagil',0,0,0],
['Bezelye (kuru)','Baklagil',0,0,0],['BÃ¶rÃ¼lce','Baklagil',0,0,0],

// SEBZELER
['HaÅŸlama patates','Sebze',1,1,0],['Patates pÃ¼resi','Sebze',1,1,0],['HaÅŸlama havuÃ§','Sebze',1,1,0],
['PiÅŸmiÅŸ kabak','Sebze',1,1,0],['PiÅŸmiÅŸ patlÄ±can (kabuksuz)','Sebze',1,0,0],['Domates (soyulmuÅŸ, Ã§ekirdeksiz)','Sebze',1,0,0],
['Brokoli','Sebze',0,0,0],['Karnabahar','Sebze',0,0,0],['Lahana','Sebze',0,0,0],['BrÃ¼ksel lahanasÄ±','Sebze',0,0,0],
['Ispanak','Sebze',0,0,0],['PazÄ±','Sebze',0,0,0],['MÄ±sÄ±r','Sebze',0,0,0],['Bamya','Sebze',0,0,0],
['Enginar','Sebze',0,0,0],['Kereviz','Sebze',0,0,0],['Pancar','Sebze',0,0,0],['Turp','Sebze',0,0,0],
['Biber (Ã§iÄŸ)','Sebze',0,0,0],['SalatalÄ±k (Ã§iÄŸ)','Sebze',0,0,0],['YeÅŸil salata','Sebze',0,0,0],['Roka','Sebze',0,0,0],
['Maydanoz','Sebze',0,0,0],['Dereotu','Sebze',0,0,0],['SoÄŸan (Ã§iÄŸ)','Sebze',0,0,0],['SarÄ±msak','Sebze',0,0,0],

// MEYVELER
['Muz','Meyve',1,1,0],['Kavun','Meyve',1,1,0],['Karpuz (Ã§ekirdeksiz)','Meyve',1,1,0],
['Åeftali (kabuksuz)','Meyve',1,0,0],['Elma (kabuksuz, piÅŸmiÅŸ)','Meyve',1,0,0],['Armut (kabuksuz, piÅŸmiÅŸ)','Meyve',1,0,0],
['Elma (Ã§iÄŸ, kabuklu)','Meyve',0,0,0],['Portakal','Meyve',0,0,0],['Mandalina','Meyve',0,0,0],
['Ã‡ilek','Meyve',0,0,0],['Nar','Meyve',0,0,0],['ÃœzÃ¼m','Meyve',0,0,0],['Kiraz','Meyve',0,0,0],['Erik','Meyve',0,0,0],
['Kuru kayÄ±sÄ±','Meyve',0,0,0],['Kuru incir','Meyve',0,0,0],['Kuru Ã¼zÃ¼m','Meyve',0,0,0],['Hurma','Meyve',0,0,0],['Ceviz','KuruyemiÅŸ',0,0,0],['FÄ±ndÄ±k','KuruyemiÅŸ',0,0,0],['Badem','KuruyemiÅŸ',0,0,0],['FÄ±stÄ±k','KuruyemiÅŸ',0,0,0],

// SÃœT ÃœRÃœNLERÄ°
['Beyaz peynir (az)','SÃ¼t ÃœrÃ¼nÃ¼',1,1,0],['KaÅŸar peyniri','SÃ¼t ÃœrÃ¼nÃ¼',1,0,0],['Lor peyniri','SÃ¼t ÃœrÃ¼nÃ¼',1,1,0],
['SÃ¼t (az)','SÃ¼t ÃœrÃ¼nÃ¼',2,0,0],['YoÄŸurt (sade)','SÃ¼t ÃœrÃ¼nÃ¼',2,0,0],['Ayran','SÃ¼t ÃœrÃ¼nÃ¼',0,0,0],['Kefir','SÃ¼t ÃœrÃ¼nÃ¼',0,0,0],
['Dondurma','SÃ¼t ÃœrÃ¼nÃ¼',0,0,0],['Kaymak','SÃ¼t ÃœrÃ¼nÃ¼',0,0,0],['Krema','SÃ¼t ÃœrÃ¼nÃ¼',0,0,0],

// Ä°Ã‡ECEKLER
['Su','Ä°Ã§ecek',1,1,1],['Sade Ã§ay','Ä°Ã§ecek',1,1,1],['Bitki Ã§aylarÄ±','Ä°Ã§ecek',1,1,1],
['Filtre kahve (sade)','Ä°Ã§ecek',1,1,0],['TÃ¼rk kahvesi (sade)','Ä°Ã§ecek',1,0,0],
['SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu','Ä°Ã§ecek',1,1,1],['Beyaz Ã¼zÃ¼m suyu','Ä°Ã§ecek',1,1,1],
['Berrak limonata','Ä°Ã§ecek',1,1,1],['Berrak gazlÄ± iÃ§ecek','Ä°Ã§ecek',0,0,1],
['Bal (suya/Ã§aya)','Ä°Ã§ecek',1,1,1],['Åeker (Ã§aya)','Ä°Ã§ecek',1,1,1],
['PosalÄ± meyve suyu','Ä°Ã§ecek',0,0,0],['Alkol','Ä°Ã§ecek',0,0,0],['Bira','Ä°Ã§ecek',0,0,0],['Åarap','Ä°Ã§ecek',0,0,0],
['Boza','Ä°Ã§ecek',0,0,0],['Åalgam','Ä°Ã§ecek',0,0,0],['Smoothie','Ä°Ã§ecek',0,0,0],
['SÃ¼tlÃ¼ kahve','Ä°Ã§ecek',0,0,0],['Cappuccino','Ä°Ã§ecek',0,0,0],

// Ã‡ORBALAR
['Tavuk suyu (sÃ¼zÃ¼lmÃ¼ÅŸ, berrak)','Ã‡orba',1,1,1],['Et suyu (sÃ¼zÃ¼lmÃ¼ÅŸ, berrak)','Ã‡orba',1,1,1],
['Åehriye Ã§orbasÄ± (sÃ¼zÃ¼lmÃ¼ÅŸ)','Ã‡orba',1,1,0],['Tarhana Ã§orbasÄ±','Ã‡orba',2,0,0],
['Mercimek Ã§orbasÄ±','Ã‡orba',0,0,0],['Ezogelin Ã§orbasÄ±','Ã‡orba',0,0,0],['Yayla Ã§orbasÄ±','Ã‡orba',0,0,0],
['Ä°ÅŸkembe Ã§orbasÄ±','Ã‡orba',0,0,0],['Domates Ã§orbasÄ± (sÃ¼zÃ¼lmÃ¼ÅŸ)','Ã‡orba',1,1,0],

// TÃœRK MUTFAÄI Ã–ZEL
['Peynirli bÃ¶rek (sade)','TÃ¼rk MutfaÄŸÄ±',1,0,0],['IspanaklÄ± bÃ¶rek','TÃ¼rk MutfaÄŸÄ±',0,0,0],['KÄ±ymalÄ± bÃ¶rek','TÃ¼rk MutfaÄŸÄ±',0,0,0],
['Peynirli gÃ¶zleme','TÃ¼rk MutfaÄŸÄ±',1,0,0],['Patatesli gÃ¶zleme','TÃ¼rk MutfaÄŸÄ±',1,0,0],
['MantÄ± (az, sade)','TÃ¼rk MutfaÄŸÄ±',2,0,0],['Lahmacun','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Pide (sade peynirli)','TÃ¼rk MutfaÄŸÄ±',1,0,0],
['KarnÄ±yarÄ±k','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Ä°mam bayÄ±ldÄ±','TÃ¼rk MutfaÄŸÄ±',0,0,0],['TÃ¼rlÃ¼','TÃ¼rk MutfaÄŸÄ±',0,0,0],
['Dolma (yaprak sarmasÄ±)','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Etli nohut','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Kuru fasulye yemeÄŸi','TÃ¼rk MutfaÄŸÄ±',0,0,0],
['Kebap (ÅŸiÅŸ)','TÃ¼rk MutfaÄŸÄ±',1,0,0],['Adana kebap','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Ä°skender','TÃ¼rk MutfaÄŸÄ±',0,0,0],
['DÃ¶ner (tavuk)','TÃ¼rk MutfaÄŸÄ±',1,0,0],['Ã‡iÄŸ kÃ¶fte','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Ä°Ã§li kÃ¶fte','TÃ¼rk MutfaÄŸÄ±',0,0,0],
['Midye dolma','TÃ¼rk MutfaÄŸÄ±',0,0,0],['KokoreÃ§','TÃ¼rk MutfaÄŸÄ±',0,0,0],['Tantuni','TÃ¼rk MutfaÄŸÄ±',0,0,0],

// TATLILAR & ATIÅTIRMALIK
['Bal','TatlÄ±',1,1,1],['ReÃ§el (sÃ¼zÃ¼lmÃ¼ÅŸ)','TatlÄ±',1,1,0],['Pekmez (az)','TatlÄ±',1,0,0],
['Jelatin tatlÄ±sÄ± (sarÄ±/yeÅŸil)','TatlÄ±',1,1,1],['AÃ§Ä±k renkli jelibon','TatlÄ±',0,0,1],
['SÃ¼tlaÃ§','TatlÄ±',2,0,0],['Muhallebi','TatlÄ±',2,0,0],['Kazandibi','TatlÄ±',2,0,0],
['Puding (sade)','TatlÄ±',2,0,0],['Baklava','TatlÄ±',0,0,0],['KÃ¼nefe','TatlÄ±',0,0,0],
['Ã‡ikolata','TatlÄ±',0,0,0],['Lokum','TatlÄ±',0,0,0],['Helva','TatlÄ±',0,0,0],
['Kek (sade)','TatlÄ±',1,0,0],['PoÄŸaÃ§a (sade)','TatlÄ±',1,0,0],['AÃ§ma (sade)','TatlÄ±',1,0,0],
['Komposto (sÃ¼zÃ¼lmÃ¼ÅŸ)','TatlÄ±',1,1,1],['HoÅŸaf (sÃ¼zÃ¼lmÃ¼ÅŸ)','TatlÄ±',1,1,1],
];

// Meals per day
const MEALS={
3:[
  {h:'07:00',l:'KahvaltÄ±',items:['Beyaz ekmek','HaÅŸlama yumurta','Beyaz peynir','Bal','Sade Ã§ay']},
  {h:'10:00',l:'KuÅŸluk',items:['Galeta','Muz','SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu']},
  {h:'12:30',l:'Ã–ÄŸle',items:['PirinÃ§ pilavÄ±','Izgara tavuk gÃ¶ÄŸsÃ¼','HaÅŸlama havuÃ§','Su']},
  {h:'15:30',l:'Ä°kindi',items:['Kraker','Beyaz peynir','Bitki Ã§ayÄ±']},
  {h:'19:00',l:'AkÅŸam',items:['Makarna (sade)','Izgara balÄ±k','Patates pÃ¼resi','Komposto']},
  {h:'21:30',l:'Gece',items:['BiskÃ¼vi','Bal + Ã§ay','1 bardak su']}
],
2:[
  {h:'07:00',l:'KahvaltÄ±',items:['Galeta + bal','HaÅŸlama yumurta','Sade Ã§ay']},
  {h:'10:00',l:'KuÅŸluk',items:['Kraker','SÃ¼zÃ¼lmÃ¼ÅŸ meyve suyu']},
  {h:'12:30',l:'Ã–ÄŸle',items:['Berrak tavuk suyu','Az pirinÃ§','Su']},
  {h:'15:30',l:'Ä°kindi',items:['Galeta','Bal + Ã§ay']},
  {h:'19:00',l:'AkÅŸam',items:['HaÅŸlama patates','Berrak et suyu','Komposto']},
  {h:'21:30',l:'Gece',items:['Jelatin tatlÄ±sÄ±','Bol su']}
],
1:[
  {h:'08:00',l:'Sabah',items:['2 bardak su','Sade Ã§ay + bal','SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu']},
  {h:'10:00',l:'KuÅŸluk',items:['Berrak tavuk suyu','ÃœzÃ¼m suyu']},
  {h:'12:00',l:'Ã–ÄŸle',items:['Berrak et suyu','Limonata','Jelatin tatlÄ±sÄ±']},
  {h:'15:00',l:'Ä°kindi',items:['Elma suyu','Bitki Ã§ayÄ± + bal']},
  {h:'18:00',l:'AkÅŸam',items:['Berrak tavuk suyu','Ã‡ay + bal','Bol su']},
  {h:'20:00',l:'Gece',items:['HoÅŸaf (sÃ¼zÃ¼lmÃ¼ÅŸ)','Su â€” idrar berrak olmalÄ±!']}
],
0:[
  {h:'Erken',l:'2. Doz Ä°laÃ§',items:['Ä°lacÄ±nÄ±zÄ± zamanÄ±nda alÄ±n','Berrak sÄ±vÄ± ile destekleyin']},
  {h:'NPO',l:'Durma Saati',items:['Ä°ÅŸlemden 2 saat Ã¶nce aÄŸÄ±zdan HÄ°Ã‡BÄ°R ÅEY','DÃ¼zenli ilaÃ§lar az su ile alÄ±nabilir']}
]};

const DAY_INFO={
  3:{ico:'ğŸ½ï¸',title:'DÃ¼ÅŸÃ¼k Lifli Diyet',desc:'Sindirilmesi kolay gÄ±dalar yiyin. Lifli, posalÄ±, kabuklu gÄ±dalardan uzak durun.',rule:'GÃ¼nde 2.5 L sÄ±vÄ± hedefleyin',goal:10},
  2:{ico:'ğŸ²',title:'AzaltÄ±lmÄ±ÅŸ Diyet',desc:'Daha da hafifleyin. Sade, kolay sindirilir gÄ±dalara geÃ§in.',rule:'GÃ¼nde 3 L sÄ±vÄ± hedefleyin',goal:12},
  1:{ico:'ğŸ’§',title:'Sadece Berrak SÄ±vÄ±lar',desc:'KatÄ± gÄ±da kesinlikle yasak! ArkasÄ±ndaki yazÄ±yÄ± okuyabildiÄŸiniz sÄ±vÄ±lar.',rule:'GÃ¼nde 3â€“4 L berrak sÄ±vÄ± iÃ§in',goal:16},
  0:{ico:'â›”',title:'Ä°ÅŸlem GÃ¼nÃ¼',desc:'2. doz ilacÄ±nÄ±zÄ± alÄ±n. Ä°ÅŸlemden 2 saat Ã¶nce her ÅŸeyi durdurun.',rule:'NPO â€” 2 saat Ã¶nce HÄ°Ã‡BÄ°R ÅEY',goal:0}
};

const CATS={
  'Ekmek':{ico:'ğŸ',name:'Ekmek & Unlu'},'TahÄ±l':{ico:'ğŸŒ¾',name:'TahÄ±llar & Makarna'},'Protein':{ico:'ğŸ—',name:'Et, BalÄ±k & Yumurta'},
  'Baklagil':{ico:'ğŸ«˜',name:'Baklagiller'},'Sebze':{ico:'ğŸ¥•',name:'Sebzeler'},'Meyve':{ico:'ğŸ',name:'Meyveler'},
  'KuruyemiÅŸ':{ico:'ğŸ¥œ',name:'KuruyemiÅŸler'},'SÃ¼t ÃœrÃ¼nÃ¼':{ico:'ğŸ§€',name:'SÃ¼t ÃœrÃ¼nleri'},'Ä°Ã§ecek':{ico:'ğŸ¥¤',name:'Ä°Ã§ecekler'},
  'Ã‡orba':{ico:'ğŸ²',name:'Ã‡orbalar'},'TÃ¼rk MutfaÄŸÄ±':{ico:'ğŸ‡¹ğŸ‡·',name:'TÃ¼rk MutfaÄŸÄ± Ã–zel'},'TatlÄ±':{ico:'ğŸ¯',name:'TatlÄ± & AtÄ±ÅŸtÄ±rmalÄ±k'}
};

// WIZARD
$('wDate').addEventListener('change',function(){S.date=this.value;$('ws1next').disabled=!this.value});
function wizNext(n){document.querySelectorAll('.wiz-step').forEach(s=>s.classList.remove('on'));$('ws'+n).classList.add('on')}
function wizBack(n){wizNext(n)}
function pickTime(t,el){S.time=t;document.querySelectorAll('#ws2 .opt2').forEach(e=>e.classList.remove('sel'));el.classList.add('sel');$('ws2next').disabled=false}
function pickDrug(d,el){S.drug=d;document.querySelectorAll('#ws3 .opt').forEach(e=>e.classList.remove('sel'));el.classList.add('sel');$('ws3next').disabled=false}
function startApp(){S.tasks={};S.checks={};S.water={};save();$('nav').classList.add('on');go('home')}
function resetApp(){if(confirm('HazÄ±rlÄ±k verileriniz silinecek. Emin misiniz?')){S={date:null,time:null,drug:null,tasks:{},checks:{},stool:null,water:{},name:S.name||''};save();goWizard();$('nav').classList.remove('on')}}

// NAV
function go(id){
  document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));$(id).classList.add('on');
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.nb')[[,'home','diet','drug','stool','check'].indexOf(id)]?.classList.add('on');
  if(id==='home')renderHome();if(id==='diet')renderDiet();if(id==='drug')renderDrug();if(id==='check')renderCheck();
  window.scrollTo(0,0);
}

// DASHBOARD
function daysLeft(){const p=new Date(S.date+'T00:00:00'),n=new Date(),t=new Date(n.getFullYear(),n.getMonth(),n.getDate());return Math.ceil((p-t)/864e5)}
function renderHome(){
  $('userName').textContent=S.name||'Hasta';
  const dl=daysLeft();
  if(dl>0){$('hNum').textContent=dl;$('hUnit').textContent=' gÃ¼n';$('hNum').style.fontSize='';}
  else if(dl===0){$('hNum').textContent='BugÃ¼n!';$('hUnit').textContent='';$('hNum').style.fontSize='42px';}
  else{$('hNum').textContent='âœ“';$('hUnit').textContent='';$('hNum').style.fontSize='52px';}
  const pd=new Date(S.date+'T00:00:00');
  $('hDetail').textContent=pd.toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long'})+' Â· '+(S.time==='morning'?'Sabah':'Ã–ÄŸleden Sonra');
  let ph;
  if(dl>3)ph={c:'green',t:'HAZIRLIK Ã–NCESÄ°',n:'Normal Beslenme',d:'HenÃ¼z diyet deÄŸiÅŸikliÄŸine gerek yok. Ä°laÃ§larÄ±nÄ±zÄ± ve alÄ±ÅŸveriÅŸinizi hazÄ±rlayÄ±n.'};
  else if(dl===3)ph={c:'orange',t:'3 GÃœN Ã–NCE',n:'DÃ¼ÅŸÃ¼k Lifli Diyet',d:'BugÃ¼nden itibaren beyaz ekmek, pilav, tavuk, yumurta. Lifli gÄ±dalardan kaÃ§Ä±nÄ±n.'};
  else if(dl===2)ph={c:'orange',t:'2 GÃœN Ã–NCE',n:'AzaltÄ±lmÄ±ÅŸ Diyet',d:'Makarna, patates pÃ¼resi, berrak Ã§orbalar. KÄ±zartma ve aÄŸÄ±r yemek yok.'};
  else if(dl===1)ph={c:'bx',t:'1 GÃœN Ã–NCE',n:'Berrak SÄ±vÄ± + Ä°laÃ§',d:'Sadece berrak sÄ±vÄ±lar! KatÄ± gÄ±da yasak. BugÃ¼n ilaÃ§ dozlarÄ±nÄ±zÄ± alacaksÄ±nÄ±z.'};
  else if(dl===0)ph={c:'bx',t:'Ä°ÅLEM GÃœNÃœ',n:'Kolonoskopi GÃ¼nÃ¼',d:'Ä°ÅŸlemden 2 saat Ã¶nce aÄŸÄ±zdan hiÃ§bir ÅŸey almayÄ±n. RefakatÃ§i zorunlu!'};
  else ph={c:'green',t:'Ä°ÅLEM SONRASI',n:'TamamlandÄ±',d:'Hafif beslenmeye baÅŸlayabilirsiniz.'};
  $('phaseEl').innerHTML=`<div class="phase ${ph.c}"><div class="phase-tag">${ph.t}</div><div class="phase-title">${ph.n}</div><div class="phase-desc">${ph.d}</div></div>`;
  const tot=4,el=Math.max(0,Math.min(tot,tot-dl)),pct=Math.round(el/tot*100);
  $('pFill').style.width=pct+'%';$('pPct').textContent=pct+'%';
  renderTasks(dl);
}
function renderTasks(dl){
  let ts=[];const d=S.drug,m=S.time==='morning';
  if(dl>3)ts=[{id:'shop',t:'ğŸ›’ AlÄ±ÅŸveriÅŸ yapÄ±n',d:'Ä°laÃ§, berrak sÄ±vÄ±lar, Ä±slak mendil, vazelin'},{id:'meds',t:'ğŸ’Š Ä°laÃ§larÄ± kontrol edin',d:'GLP-1, kan sulandÄ±rÄ±cÄ±, diyabet, demir'}];
  else if(dl===3)ts=[{id:'d3',t:'ğŸš DÃ¼ÅŸÃ¼k lifli diyete geÃ§in',d:'Beyaz ekmek, pilav, tavuk, yumurta',tm:'TÃ¼m gÃ¼n'},{id:'w3',t:'ğŸ’§ 2.5 L sÄ±vÄ± iÃ§in',d:'Su, Ã§ay, sÃ¼zÃ¼lmÃ¼ÅŸ meyve suyu'}];
  else if(dl===2)ts=[{id:'d2',t:'ğŸœ Hafif yemeklere geÃ§in',d:'Makarna, haÅŸlama patates, berrak Ã§orba',tm:'TÃ¼m gÃ¼n'},{id:'w2',t:'ğŸ’§ 3 L sÄ±vÄ± iÃ§in',d:'SÄ±vÄ±yÄ± artÄ±rÄ±n'}];
  else if(dl===1){
    ts=[{id:'cl',t:'ğŸ¥¤ Sadece berrak sÄ±vÄ±!',d:'KatÄ± gÄ±da kesinlikle yasak',tm:'TÃ¼m gÃ¼n'},{id:'w1',t:'ğŸ’§ 3â€“4 L berrak sÄ±vÄ±',d:'Ã‡ay, elma suyu, tavuk suyu, su'}];
    if(d==='peg2'){ts.push({id:'d1',t:'ğŸ’Š 1. Doz â€” 1L Pegdin',d:'Her 15 dk 250 ml. SoÄŸuk, pipet ile',tm:m?'18:00':'18:00'});ts.push({id:'e1',t:'ğŸ’§ 500 ml ek sÄ±vÄ±',d:'Ä°laÃ§ sonrasÄ±'});}
    else if(d==='picoprep'){ts.push({id:'d1',t:'ğŸ’Š 1. SaÅŸe Picoprep',d:'150 ml soÄŸuk su ile',tm:m?'16:00':'17:00'});ts.push({id:'e1',t:'ğŸ’§ 5 bardak sÄ±vÄ±',d:'SaÅŸe sonrasÄ± 5 saatte'});}
    else if(d==='fortrans'){ts.push({id:'d1',t:'ğŸ’Š 1. Doz â€” 2L Fortrans',d:'Her 15 dk 250 ml',tm:m?'17:00':'18:00'});ts.push({id:'e1',t:'ğŸ’§ 1L ek sÄ±vÄ±',d:'Ä°laÃ§ sonrasÄ±'});}
    else if(d==='phospho')ts.push({id:'d1',t:'ğŸ’Š 1. Doz â€” 45ml Fleet',d:'Â½ bardak su + 3 bardak sÄ±vÄ±',tm:'18:00'});
  } else if(dl===0){
    if(d==='peg2')ts.push({id:'d2x',t:'ğŸ’Š 2. Doz â€” 1L Pegdin',d:'+500ml sÄ±vÄ±',tm:m?'03:00':'07:00'});
    else if(d==='picoprep')ts.push({id:'d2x',t:'ğŸ’Š 2. SaÅŸe Picoprep',d:'+3 bardak sÄ±vÄ±',tm:m?'03:00':'06:00'});
    else if(d==='fortrans')ts.push({id:'d2x',t:'ğŸ’Š 2. Doz â€” 2L Fortrans',d:'Ä°ÅŸlemden 5 saat Ã¶nce',tm:m?'03:00':'07:00'});
    else if(d==='phospho')ts.push({id:'d2x',t:'ğŸ’Š 2. Doz â€” 45ml Fleet',d:'+3 bardak sÄ±vÄ±',tm:m?'03:00':'07:00'});
    ts.push({id:'stp',t:'â›” DURMA SAATÄ°',d:'2 saat Ã¶nce HÄ°Ã‡BÄ°R ÅEY!',tm:'NPO'},{id:'ref',t:'ğŸ‘¥ RefakatÃ§i hazÄ±r',d:'RefakatÃ§isiz iÅŸlem yapÄ±lamaz!'},{id:'doc',t:'ğŸ“„ Evraklar hazÄ±r',d:'Kimlik, sigorta, tetkikler'});
  }
  $('tList').innerHTML=ts.map(t=>`<div class="task ${S.tasks[t.id]?'done':''}" onclick="togTask('${t.id}')"><div class="tck">${S.tasks[t.id]?'âœ“':''}</div><div class="t-body"><h4>${t.t}</h4><p>${t.d}</p></div>${t.tm?`<div class="t-time">${t.tm}</div>`:''}</div>`).join('');
}
function togTask(id){S.tasks[id]=!S.tasks[id];save();renderHome()}

// DIET
let curDay=3;
function renderDiet(){
  const dl=daysLeft();curDay=[3,2,1,0].includes(dl)?dl:dl>3?3:0;
  $('dTabs').innerHTML=[3,2,1,0].map(d=>`<div class="dtab ${d===curDay?'on':''}" onclick="showDay(${d})">${d===0?'Ä°ÅŸlem GÃ¼nÃ¼':d+' GÃ¼n Ã–nce'}</div>`).join('');
  showDay(curDay);
}
function showDay(d){
  curDay=d;document.querySelectorAll('.dtab').forEach((t,i)=>t.classList.toggle('on',[3,2,1,0][i]===d));
  $('searchInput').value='';$('searchRes').innerHTML='';
  const info=DAY_INFO[d];

  // Day hero
  $('dayHero').innerHTML=`<div class="day-hero"><div class="dh-ico">${info.ico}</div><h2>${info.title}</h2><p>${info.desc}</p><div class="dh-rule">${info.rule}</div></div>`;

  // Hydration
  if(info.goal>0){
    const wKey='w'+d;if(!S.water[wKey])S.water[wKey]=0;
    const filled=S.water[wKey],pct=Math.min(100,Math.round(filled/info.goal*100));
    const ml=filled*250,goalMl=info.goal*250;
    $('hydroEl').innerHTML=`<div class="hydro"><div class="hydro-head"><h3>ğŸ’§ SÄ±vÄ± Takibi</h3><span>${ml} ml / ${goalMl} ml</span></div><div class="hydro-bar"><div class="hydro-fill" style="width:${pct}%"></div></div><div class="glasses">${Array.from({length:info.goal},(_, i)=>`<div class="glass ${i<filled?'full':''}" onclick="tapGlass(${d},${i})">${i<filled?'ğŸ’§':'ğŸ’¨'}</div>`).join('')}</div></div>`;
  } else $('hydroEl').innerHTML='';

  // Meals
  const meals=MEALS[d];
  $('mealTL').innerHTML=`<div class="meal-tl"><div class="meal-tl-head">ğŸ½ï¸ Ã–ÄŸÃ¼n PlanÄ±</div>${meals.map(m=>`<div class="meal-card"><div class="mc-time"><div class="mt-hour">${m.h}</div><div class="mt-label">${m.l}</div></div><div class="mc-body"><div class="mc-items">${m.items.map(i=>`<span class="mc-chip">âœ“ ${i}</span>`).join('')}</div></div></div>`).join('')}</div>`;

  // Category accordions
  const dayIdx=d===3?2:d===2?3:d===1?4:4;
  const catOrder=['Ekmek','TahÄ±l','Protein','Baklagil','Sebze','Meyve','KuruyemiÅŸ','SÃ¼t ÃœrÃ¼nÃ¼','Ä°Ã§ecek','Ã‡orba','TÃ¼rk MutfaÄŸÄ±','TatlÄ±'];
  let accHtml='<div class="cat-section"><div class="cs-head">ğŸ“‹ TÃ¼m GÄ±dalar â€” DetaylÄ± Liste</div>';
  catOrder.forEach(cat=>{
    const items=FOODS.filter(f=>f[1]===cat);if(!items.length)return;
    const ci=CATS[cat];
    const yesItems=items.filter(f=>f[dayIdx]===1);
    const noItems=items.filter(f=>f[dayIdx]===0);
    const maybeItems=items.filter(f=>f[dayIdx]===2);
    accHtml+=`<div class="acc" onclick="this.classList.toggle('open')"><div class="acc-head"><span class="ah-ico">${ci.ico}</span><h4>${ci.name} <span style="color:var(--green);font-size:12px">${yesItems.length}âœ“</span> <span style="color:var(--red);font-size:12px">${noItems.length}âœ—</span></h4><span class="ah-arrow">â–¼</span></div><div class="acc-body"><div class="acc-inner">`;
    yesItems.forEach(f=>accHtml+=`<div class="fi yes"><span class="fi-m">âœ“</span>${f[0]}</div>`);
    maybeItems.forEach(f=>accHtml+=`<div class="fi maybe"><span class="fi-m">âš </span>${f[0]} (az miktarda)</div>`);
    noItems.forEach(f=>accHtml+=`<div class="fi no"><span class="fi-m">âœ—</span>${f[0]}</div>`);
    accHtml+=`</div></div></div>`;
  });
  accHtml+='</div>';
  $('catAccs').innerHTML=accHtml;
}

function tapGlass(d,i){
  const wKey='w'+d;
  if(!S.water[wKey])S.water[wKey]=0;
  S.water[wKey]=S.water[wKey]===i+1?i:i+1;
  save();showDay(d);
}

// SEARCH
function doSearch(q){
  q=q.trim().toLowerCase();
  if(q.length<2){$('searchRes').innerHTML='';return;}
  const dayIdx=curDay===3?2:curDay===2?3:curDay===1?4:4;
  const results=FOODS.filter(f=>f[0].toLowerCase().includes(q)).slice(0,10);
  if(!results.length){$('searchRes').innerHTML=`<div class="sr-empty">SonuÃ§ bulunamadÄ±. Daha farklÄ± bir kelime deneyin.</div>`;return;}
  $('searchRes').innerHTML=results.map(f=>{
    const v=f[dayIdx];const cls=v===1?'yes':v===2?'maybe':'no';const txt=v===1?'YENÄ°LÄ°R âœ“':v===2?'DÄ°KKAT âš ':'YASAK âœ—';
    return `<div class="sr-item"><div><div class="sr-name">${f[0]}</div><div class="sr-cat">${f[1]}</div></div><div class="sr-badge ${cls}">${txt}</div></div>`;
  }).join('');
}

// DRUG
const drugNames={peg2:{n:'Pegdin',g:'PEG 2L + Askorbik Asit',ico:'ğŸŸ¦'},picoprep:{n:'Picoprep',g:'PikosÃ¼lfat + Mg Sitrat Â· 2 SaÅŸe',ico:'ğŸŸ§'},fortrans:{n:'Fortrans',g:'PEG 4L Â· Makrogol 4000',ico:'ğŸŸª'},phospho:{n:'Fleet Fosfo-Soda',g:'Sodyum Fosfat Â· 2 Ã— 45 ml',ico:'ğŸŸ©'}};
function tlI(c,n,t,ti,d,tip){return `<div class="tl-item"><div class="tl-dot ${c}">${n}</div><div class="tl-card"><div class="tl-time">${t}</div><div class="tl-title">${ti}</div><div class="tl-desc">${d}</div>${tip?`<div class="tl-tip">${tip}</div>`:''}</div></div>`}
function renderDrug(){
  const d=S.drug,m=S.time==='morning',info=drugNames[d];
  let h=`<div class="drug-head"><div class="dh-ico">${info.ico}</div><div><h3>${info.n}</h3><p>${info.g}</p></div></div><div class="timeline">`;
  if(d==='peg2'){h+=tlI('bx','1',m?'Ã–nceki gÃ¼n 18:00':'Ã–nceki gÃ¼n 18:00','1. Doz â€” 1L Pegdin','Her 10â€“15 dk 250 ml. 1â€“2 saatte. +500 ml sÄ±vÄ±.','BuzdolabÄ±nda soÄŸutun. Pipet ile iÃ§in.');h+=tlI('bx','2',m?'Ä°ÅŸlem gÃ¼nÃ¼ 03:00':'Ä°ÅŸlem gÃ¼nÃ¼ 07:00','2. Doz â€” 1L Pegdin','AynÄ± ÅŸekilde. +500 ml sÄ±vÄ±.',m?'â° Alarm kurun!':'Rahat sabah.');}
  else if(d==='picoprep'){h+=tlI('bx','1',m?'Ã–nceki gÃ¼n 16:00':'Ã–nceki gÃ¼n 17:00','1. SaÅŸe Picoprep','150 ml soÄŸuk su ile. +5 bardak sÄ±vÄ±.','Turuncu aroma â€” kolay.');h+=tlI('bx','2',m?'Ä°ÅŸlem gÃ¼nÃ¼ 03:00':'Ä°ÅŸlem gÃ¼nÃ¼ 06:00','2. SaÅŸe Picoprep','150 ml su + 3 bardak sÄ±vÄ±.',m?'â° Alarm!':'Sabah sakin.');}
  else if(d==='fortrans'){h+=tlI('bx','1',m?'Ã–nceki gÃ¼n 17:00':'Ã–nceki gÃ¼n 18:00','1. Doz â€” 2L Fortrans','Her 15 dk 250 ml. 2 saatte. +1L sÄ±vÄ±.','Limon suyu ekleyebilirsiniz.');h+=tlI('bx','2',m?'Ä°ÅŸlem gÃ¼nÃ¼ 03:00':'Ä°ÅŸlem gÃ¼nÃ¼ 07:00','2. Doz â€” 2L Fortrans','AynÄ± ÅŸekilde 2 saatte. +500 ml.',m?'â° Erken kalkÄ±ÅŸ!':'Sabah sakin.');}
  else{h+=tlI('bx','1','Ã–nceki gÃ¼n 18:00','1. Doz â€” 45ml Fleet','Â½ bardak su + 3 bardak sÄ±vÄ±.','Tuzlu â€” limonata ile deneyin.');h+=tlI('bx','2',m?'Ä°ÅŸlem gÃ¼nÃ¼ 03:00':'Ä°ÅŸlem gÃ¼nÃ¼ 07:00','2. Doz â€” 45ml Fleet','Â½ bardak su + 3 bardak sÄ±vÄ±.',m?'â° Erken alarm!':'Sabah sakin.');}
  h+=tlI('red','â›”','2 saat Ã¶nce','DURMA SAATÄ°','AÄŸÄ±zdan hiÃ§bir ÅŸey. Su dahil. Ä°laÃ§lar az su ile.','');
  h+=`</div><div class="stop-bar">â›” Ä°ÅLEMDEN 2 SAAT Ã–NCE<br>AÄIZDAN HÄ°Ã‡BÄ°R ÅEY<small>Su dahil â€” dÃ¼zenli ilaÃ§lar az su ile alÄ±nabilir</small></div>`;
  h+=`<div style="margin-top:20px"><div class="tasks-head">ğŸ’Š YardÄ±mcÄ± Ä°laÃ§lar (Adjuvan)</div></div>`;

  h+=`<div class="info-card"><h4>ğŸ’Š Bisacodyl (Dulcolax) â€” StimÃ¼lan Laksatif</h4>
<p><strong>Ne zaman:</strong> Doktorunuz Ã¶nerdiÄŸinde â€” Ã¶zellikle kronik kabÄ±zlÄ±k, diyabet veya Ã¶nceki yetersiz hazÄ±rlÄ±k durumunda.</p>
<p><strong>Doz:</strong> 1. dozdan <strong>1 saat Ã¶nce 10â€“15 mg</strong> (2-3 tablet) oral.</p>
<p><strong>Kaynak:</strong> USMSTF 2025 â€” yÃ¼ksek riskli hastalarda Ã¶nerilir.</p></div>`;

  h+=`<div class="info-card"><h4>ğŸƒ Bekunis (Senna/Sennosid A+B) â€” Bitkisel Laksatif</h4>
<p><strong>Ne zaman:</strong> Doktorunuz Ã¶nerdiÄŸinde â€” Ã¶zellikle:</p>
<p>â€¢ Kronik kabÄ±zlÄ±k eÄŸilimi olan hastalar<br>â€¢ Daha Ã¶nce yetersiz baÄŸÄ±rsak hazÄ±rlÄ±ÄŸÄ± olanlar<br>â€¢ YaÅŸlÄ± hastalar veya dÃ¼ÅŸÃ¼k hareket kapasitesi<br>â€¢ Opioid veya kabÄ±zlÄ±k yapan ilaÃ§ kullananlar</p>
<p><strong>Doz:</strong> HazÄ±rlÄ±ktan Ã¶nceki gece yatmadan Ã¶nce <strong>2â€“3 tablet.</strong></p>
<p><strong>Not:</strong> Spastik kabÄ±zlÄ±k ve baÄŸÄ±rsak tÄ±kanÄ±klÄ±ÄŸÄ±nda kullanÄ±lmaz. Doktorunuz karar verir.</p></div>`;

  h+=`<div class="info-card"><h4>ğŸ’¨ Simetikon (Ozmolak / Sab Simplex) â€” KÃ¶pÃ¼k Giderici</h4>
<p><strong>Ne zaman:</strong> USMSTF 2025 tÃ¼m kolonoskopilerde adjuvan olarak <strong>Ã¶nerir</strong> (orta dÃ¼zey kanÄ±t).</p>
<p>â€¢ Gaz ve ÅŸiÅŸkinlik ÅŸikayeti olan hastalar<br>â€¢ KÃ¶pÃ¼klenme nedeniyle gÃ¶rÃ¼ntÃ¼ kalitesi dÃ¼ÅŸÃ¼k olanlar<br>â€¢ GÃ¶rÃ¼ntÃ¼ netliÄŸini artÄ±rmak isteyen tÃ¼m hastalar</p>
<p><strong>Doz:</strong> HazÄ±rlÄ±k ilacÄ±yla birlikte <strong>en az 320 mg</strong> oral (genellikle 4Ã—80 mg veya 2Ã—160 mg).</p>
<p><strong>Etki:</strong> Mide ve baÄŸÄ±rsaklardaki gaz kabarcÄ±klarÄ±nÄ±n yÃ¼zey gerilimini azaltÄ±r â†’ daha temiz gÃ¶rÃ¼ntÃ¼.</p></div>`;

  h+=`<div class="info-card"><h4>ğŸš¿ Kurtarma â€” Lavman (Fleet Enema)</h4>
<p><strong>Ne zaman:</strong> HazÄ±rlÄ±k sonrasÄ± dÄ±ÅŸkÄ± hÃ¢lÃ¢ berrak deÄŸilse, doktorunuz Ã¶nerebilir.</p>
<p><strong>Uygulama:</strong> Ä°ÅŸlemden 2â€“3 saat Ã¶nce. <strong>Kendi kararÄ±nÄ±zla uygulamayÄ±n.</strong></p></div>`;
  h+=`<div style="margin-top:20px"><div class="tasks-head">ğŸ’¡ Konfor Ä°puÃ§larÄ±</div></div><div class="tips-grid"><div class="tip-card"><div class="tc-ico">ğŸ§Š</div><p>SoÄŸutun</p></div><div class="tip-card"><div class="tc-ico">ğŸ¥¤</div><p>Pipet kullanÄ±n</p></div><div class="tip-card"><div class="tc-ico">ğŸ¬</div><p>Nane / limon</p></div><div class="tip-card"><div class="tc-ico">ğŸš¶</div><p>YÃ¼rÃ¼yÃ¼ÅŸ yapÄ±n</p></div><div class="tip-card"><div class="tc-ico">ğŸ§´</div><p>Vazelin sÃ¼rÃ¼n</p></div><div class="tip-card"><div class="tc-ico">ğŸ§»</div><p>Islak mendil</p></div><div class="tip-card"><div class="tc-ico">ğŸ‘–</div><p>Rahat pantolon</p></div><div class="tip-card"><div class="tc-ico">ğŸ“±</div><p>Åarj + telefon</p></div></div>`;
  $('drugEl').innerHTML=h;
}

// STOOL
function pickStool(n){
  S.stool=n;save();document.querySelectorAll('.si').forEach((el,i)=>el.classList.toggle('sel',i+1===n));
  const msgs={1:{e:'â³',m:'HenÃ¼z baÅŸlangÄ±Ã§ta',d:'Ä°laÃ§ henÃ¼z etki etmemiÅŸ. Berrak sÄ±vÄ± tÃ¼ketmeye devam edin.'},2:{e:'ğŸ“ˆ',m:'Ä°lerliyorsunuz',d:'Ä°laÃ§ Ã§alÄ±ÅŸÄ±yor. Bol sÄ±vÄ±, yÃ¼rÃ¼yÃ¼ÅŸ yapÄ±n.'},3:{e:'ğŸ‘',m:'Ä°yi gidiyorsunuz!',d:'Temizlik ilerliyor. 2. dozu zamanÄ±nda alÄ±n.'},4:{e:'ğŸ¯',m:'Neredeyse tamam!',d:'Harika! Berrak sarÄ±msÄ± = iyi temizlik.'},5:{e:'ğŸ†',m:'MÃ¼kemmel!',d:'Tam hedef! Berrak ve renksiz â€” ideal.'}};
  const msg=msgs[n];$('sFb').innerHTML=`<div class="sfb-emoji">${msg.e}</div><div class="sfb-msg">${msg.m}</div><div class="sfb-detail">${msg.d}</div>`;$('sFb').classList.add('on');
}

// CHECKLIST
const clItems=['HazÄ±rlÄ±k ilacÄ±mÄ± temin ettim','Ä°laÃ§/doz ayarÄ± iÃ§in doktora danÄ±ÅŸtÄ±m','3 gÃ¼n Ã¶nce dÃ¼ÅŸÃ¼k lifli diyete geÃ§tim','2 gÃ¼n Ã¶nce hafiflettim','1 gÃ¼n Ã¶nce berrak sÄ±vÄ±ya geÃ§tim','1. doz ilacÄ± zamanÄ±nda aldÄ±m','Yeterli sÄ±vÄ± tÃ¼kettim (3+ L)','2. doz ilacÄ± zamanÄ±nda aldÄ±m','DÄ±ÅŸkÄ±m berrak sÄ±vÄ± oldu','Ä°ÅŸlemden 2 saat Ã¶nce durdum','Kimlik + sigorta kartÄ± hazÄ±r','Tetkikler hazÄ±r','Ä°laÃ§ listem hazÄ±r','Rahat kÄ±yafet giydim','RefakatÃ§im hazÄ±r'];
function renderCheck(){
  $('clItems').innerHTML=clItems.map((t,i)=>`<div class="cli ${S.checks[i]?'chk':''}" onclick="togCl(${i})"><div class="cl-box">${S.checks[i]?'âœ“':''}</div><div class="cl-txt">${t}</div></div>`).join('');
  const done=Object.values(S.checks).filter(Boolean).length,pct=Math.round(done/clItems.length*100);
  $('clRing').setAttribute('data-pct',pct+'%');$('clRing').style.background=`conic-gradient(var(--green) ${pct*3.6}deg, var(--border) 0deg)`;
  $('clLabel').textContent=`${done} / ${clItems.length} tamamlandÄ±`;
}
function togCl(i){S.checks[i]=!S.checks[i];save();renderCheck()}

// INIT â€” check if returning user with saved session
(async()=>{
  const lastKey=localStorage.getItem('kp_last');
  if(lastKey){
    userKey=lastKey;load();
    if(S.date&&S.drug){
      // Auto-login returning user
      document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));
      $('nav').classList.add('on');go('home');
    }
  }
})();
const td=new Date();$('wDate').min=td.getFullYear()+'-'+String(td.getMonth()+1).padStart(2,'0')+'-'+String(td.getDate()).padStart(2,'0');
</script>
</body>
</html>
