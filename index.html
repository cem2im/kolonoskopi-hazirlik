<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#C8102E">
<title>Kolonoskopi HazÄ±rlÄ±k â€” DoÃ§. Dr. Cem ÅimÅŸek</title>
<style>
:root {
  --bx: #C8102E;
  --bx-light: rgba(200,16,46,0.08);
  --bx-mid: rgba(200,16,46,0.15);
  --dark: #1a1a1a;
  --body: #333;
  --muted: #888;
  --light: #f7f6f4;
  --border: #e8e6e3;
  --white: #fff;
  --green: #2d8a4e;
  --orange: #d4760a;
  --red: #8B2500;
  --serif: Georgia, 'Times New Roman', serif;
  --sans: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  --radius: 12px;
  --shadow: 0 2px 12px rgba(0,0,0,0.06);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.1);
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 16px; -webkit-text-size-adjust: 100%; }
body {
  font-family: var(--sans);
  color: var(--body);
  background: var(--light);
  line-height: 1.6;
  min-height: 100dvh;
  overflow-x: hidden;
}

/* â•â•â• SCREENS â•â•â• */
.screen { display: none; min-height: 100dvh; padding-bottom: 90px; }
.screen.active { display: block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

/* â•â•â• HEADER â•â•â• */
.header {
  background: var(--white);
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0; z-index: 100;
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,0.92);
}
.header-inner { max-width: 480px; margin: 0 auto; display: flex; align-items: center; gap: 12px; }
.header-brand {
  font-family: var(--serif);
  font-size: 13px; color: var(--dark);
  letter-spacing: -0.3px; flex: 1;
}
.header-brand em { color: var(--bx); font-style: italic; }
.header-back {
  width: 36px; height: 36px; border: none; background: var(--light);
  border-radius: 50%; cursor: pointer; font-size: 18px; color: var(--dark);
  display: none; align-items: center; justify-content: center;
}
.header-back.show { display: flex; }
.header-title {
  font-family: var(--serif); font-size: 15px;
  color: var(--dark); flex: 1; text-align: center;
}

/* â•â•â• BOTTOM NAV â•â•â• */
.nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--white);
  border-top: 1px solid var(--border);
  padding: 6px 0 env(safe-area-inset-bottom, 8px);
  z-index: 200;
  display: none;
}
.nav.show { display: block; }
.nav-inner {
  max-width: 480px; margin: 0 auto;
  display: flex; justify-content: space-around;
}
.nav-btn {
  display: flex; flex-direction: column; align-items: center;
  gap: 2px; border: none; background: none; cursor: pointer;
  padding: 6px 12px; border-radius: 8px; transition: all 0.2s;
  color: var(--muted); font-size: 10px; font-family: var(--sans);
}
.nav-btn .ico { font-size: 22px; line-height: 1; }
.nav-btn.active { color: var(--bx); }
.nav-btn.active .ico { transform: scale(1.1); }

/* â•â•â• CONTAINER â•â•â• */
.container { max-width: 480px; margin: 0 auto; padding: 0 16px; }

/* â•â•â• SETUP SCREEN â•â•â• */
.setup-hero {
  text-align: center; padding: 48px 24px 32px;
  background: linear-gradient(180deg, var(--white) 0%, var(--light) 100%);
}
.setup-hero .logo-line {
  font-family: var(--sans); font-size: 10px;
  text-transform: uppercase; letter-spacing: 3px;
  color: var(--bx); margin-bottom: 16px;
}
.setup-hero h1 {
  font-family: var(--serif); font-size: 32px; font-weight: 400;
  color: var(--dark); line-height: 1.15; letter-spacing: -0.5px;
}
.setup-hero h1 em { color: var(--bx); font-style: italic; }
.setup-hero .sub {
  margin-top: 12px; font-size: 14px; color: var(--muted); line-height: 1.5;
  max-width: 320px; margin-left: auto; margin-right: auto;
}

.form-section {
  background: var(--white); border-radius: var(--radius);
  padding: 20px; margin: 12px 16px;
  box-shadow: var(--shadow);
}
.form-section h3 {
  font-family: var(--sans); font-size: 11px;
  text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--bx); font-weight: 700; margin-bottom: 12px;
}

.field { margin-bottom: 16px; }
.field label {
  display: block; font-size: 13px; color: var(--dark);
  font-weight: 600; margin-bottom: 6px;
}
.field input, .field select {
  width: 100%; padding: 12px 14px;
  border: 1.5px solid var(--border); border-radius: 8px;
  font-size: 16px; font-family: var(--sans); color: var(--dark);
  background: var(--white); appearance: none;
  transition: border-color 0.2s;
}
.field input:focus, .field select:focus {
  outline: none; border-color: var(--bx);
}
.field select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M2 4l4 4 4-4' fill='none' stroke='%23888' stroke-width='1.5'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px; }
.field .hint { font-size: 12px; color: var(--muted); margin-top: 4px; }

/* Drug selection cards */
.drug-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.drug-card {
  border: 2px solid var(--border); border-radius: 10px;
  padding: 14px 12px; cursor: pointer; text-align: center;
  transition: all 0.2s; background: var(--white);
}
.drug-card:hover { border-color: var(--bx); }
.drug-card.selected { border-color: var(--bx); background: var(--bx-light); }
.drug-card .dc-name { font-size: 14px; font-weight: 700; color: var(--dark); }
.drug-card .dc-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }
.drug-card .dc-vol { font-size: 12px; color: var(--bx); font-weight: 600; margin-top: 6px; }

/* Time selection */
.time-pills { display: flex; gap: 8px; }
.time-pill {
  flex: 1; padding: 14px 12px; border: 2px solid var(--border);
  border-radius: 10px; cursor: pointer; text-align: center;
  transition: all 0.2s; background: var(--white);
}
.time-pill:hover { border-color: var(--bx); }
.time-pill.selected { border-color: var(--bx); background: var(--bx-light); }
.time-pill .tp-label { font-size: 14px; font-weight: 700; color: var(--dark); }
.time-pill .tp-time { font-size: 12px; color: var(--muted); margin-top: 2px; }

.btn-primary {
  width: 100%; padding: 16px; border: none; border-radius: 10px;
  background: var(--bx); color: var(--white);
  font-size: 16px; font-weight: 700; font-family: var(--sans);
  cursor: pointer; letter-spacing: 0.3px;
  transition: transform 0.1s, opacity 0.2s;
  margin-top: 8px;
}
.btn-primary:active { transform: scale(0.98); }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }

/* â•â•â• DASHBOARD â•â•â• */
.countdown-card {
  background: var(--dark); color: var(--white);
  border-radius: var(--radius); padding: 24px;
  margin: 16px 0; text-align: center;
  position: relative; overflow: hidden;
}
.countdown-card::before {
  content: ''; position: absolute; top: -30px; right: -30px;
  width: 120px; height: 120px; border-radius: 50%;
  background: rgba(200,16,46,0.15);
}
.countdown-card .cc-label {
  font-size: 11px; text-transform: uppercase; letter-spacing: 2px;
  color: rgba(255,255,255,0.5); margin-bottom: 8px;
}
.countdown-card .cc-big {
  font-family: var(--serif); font-size: 56px; font-weight: 400;
  line-height: 1; letter-spacing: -2px;
}
.countdown-card .cc-unit { font-size: 18px; color: var(--bx); margin-left: 4px; font-family: var(--serif); font-style: italic; }
.countdown-card .cc-detail {
  font-size: 13px; color: rgba(255,255,255,0.6); margin-top: 8px;
}

.phase-indicator {
  background: var(--white); border-radius: var(--radius);
  padding: 20px; margin: 12px 0; box-shadow: var(--shadow);
}
.phase-indicator .pi-phase {
  font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--bx); font-weight: 700;
}
.phase-indicator .pi-title {
  font-family: var(--serif); font-size: 20px; color: var(--dark);
  margin: 4px 0 8px; letter-spacing: -0.3px;
}
.phase-indicator .pi-desc { font-size: 13px; color: var(--muted); line-height: 1.5; }

.progress-bar { background: var(--border); border-radius: 6px; height: 6px; margin: 16px 0 8px; overflow: hidden; }
.progress-bar .fill { height: 100%; background: var(--bx); border-radius: 6px; transition: width 0.5s ease; }
.progress-labels { display: flex; justify-content: space-between; font-size: 11px; color: var(--muted); }

.today-tasks {
  background: var(--white); border-radius: var(--radius);
  padding: 20px; margin: 12px 0; box-shadow: var(--shadow);
}
.today-tasks h3 {
  font-family: var(--sans); font-size: 11px;
  text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--bx); font-weight: 700; margin-bottom: 12px;
}
.task-item {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 10px 0; border-bottom: 1px solid var(--border);
}
.task-item:last-child { border-bottom: none; }
.task-check {
  width: 22px; height: 22px; border: 2px solid var(--border);
  border-radius: 6px; flex-shrink: 0; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; margin-top: 1px;
}
.task-check.done { background: var(--bx); border-color: var(--bx); color: var(--white); font-size: 12px; }
.task-body { flex: 1; }
.task-body h4 { font-size: 14px; color: var(--dark); font-weight: 600; }
.task-body p { font-size: 12px; color: var(--muted); margin-top: 2px; }
.task-time { font-size: 11px; color: var(--bx); font-weight: 600; white-space: nowrap; }

/* â•â•â• DIET SCREEN â•â•â• */
.day-tabs {
  display: flex; gap: 6px; padding: 16px 0 8px;
  overflow-x: auto; -webkit-overflow-scrolling: touch;
}
.day-tabs::-webkit-scrollbar { display: none; }
.day-tab {
  flex-shrink: 0; padding: 10px 16px; border-radius: 20px;
  border: 1.5px solid var(--border); background: var(--white);
  font-size: 13px; font-weight: 600; color: var(--muted);
  cursor: pointer; transition: all 0.2s; white-space: nowrap;
}
.day-tab.active { background: var(--bx); border-color: var(--bx); color: var(--white); }

.diet-content { margin-top: 8px; }

.food-card {
  background: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 10px 0; box-shadow: var(--shadow);
}
.food-card h3 {
  font-family: var(--serif); font-size: 16px; color: var(--dark);
  margin-bottom: 4px;
}
.food-card .fc-sub { font-size: 12px; color: var(--muted); margin-bottom: 12px; }

.food-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.food-item {
  padding: 10px 12px; border-radius: 8px; font-size: 13px; line-height: 1.4;
}
.food-item.yes { background: rgba(45,138,78,0.06); color: var(--green); }
.food-item.no { background: rgba(139,37,0,0.05); color: var(--red); text-decoration: line-through; opacity: 0.7; }
.food-item .fi-icon { margin-right: 4px; }

.meal-plan {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
  margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border);
}
.meal-slot { text-align: center; }
.meal-slot h5 {
  font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
  color: var(--bx); font-weight: 700; margin-bottom: 4px;
}
.meal-slot p { font-size: 12px; color: var(--body); line-height: 1.4; }

/* â•â•â• DRUG PROTOCOL SCREEN â•â•â• */
.protocol-header {
  background: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 16px 0 8px; box-shadow: var(--shadow);
  display: flex; gap: 14px; align-items: center;
}
.protocol-header .ph-icon { font-size: 36px; }
.protocol-header .ph-name { font-size: 16px; font-weight: 700; color: var(--dark); }
.protocol-header .ph-gen { font-size: 11px; color: var(--muted); margin-top: 2px; }

.dose-card {
  background: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 10px 0; box-shadow: var(--shadow);
  border-left: 4px solid var(--bx);
  position: relative;
}
.dose-card.done-dose { border-left-color: var(--green); opacity: 0.7; }
.dose-card.active-dose { border-left-color: var(--bx); box-shadow: var(--shadow-lg); }
.dose-card .dc-time {
  font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--bx); font-weight: 700;
}
.dose-card .dc-title { font-family: var(--serif); font-size: 16px; color: var(--dark); margin: 4px 0; }
.dose-card .dc-desc { font-size: 13px; color: var(--muted); line-height: 1.5; }
.dose-card .dc-tip {
  margin-top: 10px; padding: 10px 12px; background: var(--bx-light);
  border-radius: 8px; font-size: 12px; color: var(--bx);
}

.stop-banner {
  background: var(--red); color: var(--white);
  border-radius: var(--radius); padding: 16px 18px;
  margin: 10px 0; text-align: center;
  font-size: 14px; font-weight: 700;
  letter-spacing: 0.5px;
}

.comfort-tips {
  background: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 10px 0; box-shadow: var(--shadow);
}
.comfort-tips h3 {
  font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--bx); font-weight: 700; margin-bottom: 10px;
}
.tip-item { display: flex; gap: 10px; padding: 6px 0; font-size: 13px; color: var(--body); }
.tip-item .ti-icon { flex-shrink: 0; }

/* â•â•â• STOOL TRACKER â•â•â• */
.stool-intro {
  background: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 16px 0; box-shadow: var(--shadow);
  text-align: center;
}
.stool-intro h2 { font-family: var(--serif); font-size: 20px; color: var(--dark); margin-bottom: 6px; }
.stool-intro p { font-size: 13px; color: var(--muted); }

.stool-scale { margin: 8px 0; }
.stool-item {
  background: var(--white); border-radius: var(--radius);
  padding: 16px; margin: 8px 0; box-shadow: var(--shadow);
  display: flex; align-items: center; gap: 14px;
  cursor: pointer; transition: all 0.2s;
  border: 2px solid transparent;
}
.stool-item:hover { border-color: var(--border); }
.stool-item.selected { border-color: var(--bx); background: var(--bx-light); }
.stool-item.target-stool { position: relative; }
.stool-item.target-stool::after {
  content: 'HEDEF'; position: absolute; top: 8px; right: 12px;
  font-size: 9px; font-weight: 700; letter-spacing: 1.5px;
  color: var(--bx); font-family: var(--sans);
}
.si-color { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; }
.si-body { flex: 1; }
.si-body h4 { font-size: 14px; color: var(--dark); font-weight: 600; }
.si-body p { font-size: 12px; color: var(--muted); }

.stool-feedback {
  background: var(--white); border-radius: var(--radius);
  padding: 20px; margin: 12px 0; box-shadow: var(--shadow);
  text-align: center; display: none;
}
.stool-feedback.show { display: block; }
.stool-feedback .sf-emoji { font-size: 48px; margin-bottom: 8px; }
.stool-feedback .sf-msg { font-size: 15px; color: var(--dark); font-weight: 600; }
.stool-feedback .sf-detail { font-size: 13px; color: var(--muted); margin-top: 6px; line-height: 1.5; }

/* â•â•â• MEDICATIONS â•â•â• */
.med-warning {
  background: linear-gradient(135deg, var(--red) 0%, #a03020 100%);
  color: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 16px 0;
}
.med-warning h3 { font-size: 13px; font-weight: 700; margin-bottom: 6px; }
.med-warning p { font-size: 13px; line-height: 1.5; opacity: 0.9; }
.med-warning strong { opacity: 1; }

.med-card {
  background: var(--white); border-radius: var(--radius);
  padding: 16px; margin: 8px 0; box-shadow: var(--shadow);
}
.med-card h4 { font-size: 14px; color: var(--dark); font-weight: 700; margin-bottom: 4px; }
.med-card p { font-size: 13px; color: var(--muted); line-height: 1.5; }

/* â•â•â• CHECKLIST â•â•â• */
.checklist-card {
  background: var(--white); border-radius: var(--radius);
  padding: 18px; margin: 10px 0; box-shadow: var(--shadow);
}
.checklist-card h3 {
  font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--bx); font-weight: 700; margin-bottom: 12px;
}
.cl-item {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 0; border-bottom: 1px solid var(--border);
  cursor: pointer;
}
.cl-item:last-child { border-bottom: none; }
.cl-box {
  width: 24px; height: 24px; border: 2px solid var(--border);
  border-radius: 6px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; font-size: 14px;
}
.cl-item.checked .cl-box { background: var(--green); border-color: var(--green); color: var(--white); }
.cl-text { font-size: 14px; color: var(--dark); }
.cl-item.checked .cl-text { color: var(--muted); text-decoration: line-through; }

/* â•â•â• EMERGENCY â•â•â• */
.emergency-card {
  background: var(--white); border: 2px solid var(--red);
  border-radius: var(--radius); padding: 18px; margin: 12px 0;
}
.emergency-card h3 { color: var(--red); font-size: 14px; margin-bottom: 8px; }
.emergency-card ul { list-style: none; }
.emergency-card li { padding: 4px 0; font-size: 13px; color: var(--body); }
.emergency-card li::before { content: "âš  "; color: var(--red); }
.emergency-btn {
  display: block; width: 100%; padding: 14px; margin-top: 12px;
  background: var(--red); color: var(--white); border: none;
  border-radius: 8px; font-size: 16px; font-weight: 700;
  cursor: pointer; text-align: center; text-decoration: none;
}

/* â•â•â• FOOTER â•â•â• */
.app-footer {
  text-align: center; padding: 24px 16px 16px;
  font-size: 11px; color: var(--muted);
}
.app-footer strong { color: var(--dark); }

/* â•â•â• UTILITIES â•â•â• */
.mt-8 { margin-top: 8px; }
.mt-16 { margin-top: 16px; }
.mb-16 { margin-bottom: 16px; }
.text-center { text-align: center; }

/* Adjuvant info card */
.adjuvant-card {
  background: var(--bx-light); border-radius: 10px;
  padding: 14px 16px; margin: 10px 0;
  border-left: 3px solid var(--bx);
}
.adjuvant-card h4 { font-size: 12px; color: var(--bx); font-weight: 700; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
.adjuvant-card p { font-size: 12px; color: var(--body); line-height: 1.5; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• SETUP SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
<div id="setup" class="screen active">
  <div class="setup-hero">
    <div class="logo-line">DoÃ§. Dr. Cem ÅimÅŸek</div>
    <h1><em>Kolonoskopi</em><br>HazÄ±rlÄ±k Rehberi</h1>
    <p class="sub">BaÅŸarÄ±lÄ± bir kolonoskopi, doÄŸru hazÄ±rlÄ±ÄŸa baÄŸlÄ±dÄ±r. Bu uygulama size adÄ±m adÄ±m yol gÃ¶sterecek.</p>
  </div>

  <div class="form-section">
    <h3>Ä°ÅŸlem Bilgileri</h3>
    <div class="field">
      <label>Ä°ÅŸlem Tarihi</label>
      <input type="date" id="procDate">
    </div>
    <div class="field">
      <label>Ä°ÅŸlem ZamanÄ±</label>
      <div class="time-pills">
        <div class="time-pill" data-time="morning" onclick="selectTime(this)">
          <div class="tp-label">Sabah</div>
          <div class="tp-time">08:00 â€“ 12:00</div>
        </div>
        <div class="time-pill" data-time="afternoon" onclick="selectTime(this)">
          <div class="tp-label">Ã–ÄŸleden Sonra</div>
          <div class="tp-time">13:00+</div>
        </div>
      </div>
    </div>
  </div>

  <div class="form-section">
    <h3>Ä°laÃ§ ProtokolÃ¼</h3>
    <div class="drug-cards">
      <div class="drug-card" data-drug="peg2" onclick="selectDrug(this)">
        <div class="dc-name">Pegdin</div>
        <div class="dc-sub">PEG + Askorbik Asit</div>
        <div class="dc-vol">2 Litre</div>
      </div>
      <div class="drug-card" data-drug="picoprep" onclick="selectDrug(this)">
        <div class="dc-name">Picoprep</div>
        <div class="dc-sub">PikosÃ¼lfat + Mg Sitrat</div>
        <div class="dc-vol">2 SaÅŸe</div>
      </div>
      <div class="drug-card" data-drug="fortrans" onclick="selectDrug(this)">
        <div class="dc-name">Fortrans</div>
        <div class="dc-sub">PEG 4000 (Klasik)</div>
        <div class="dc-vol">4 Litre</div>
      </div>
      <div class="drug-card" data-drug="phospho" onclick="selectDrug(this)">
        <div class="dc-name">Fleet Fosfo-Soda</div>
        <div class="dc-sub">Sodyum Fosfat Oral</div>
        <div class="dc-vol">2 Ã— 45 ml</div>
      </div>
    </div>
    <p class="hint mt-8">Doktorunuzun reÃ§ete ettiÄŸi ilacÄ± seÃ§in.</p>
  </div>

  <div style="padding: 0 16px 32px;">
    <button class="btn-primary" id="startBtn" onclick="startApp()" disabled>HazÄ±rlÄ±ÄŸa BaÅŸla</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â• -->
<div id="dashboard" class="screen">
  <div class="header">
    <div class="header-inner">
      <div class="header-brand">DoÃ§. Dr. Cem ÅimÅŸek â€” <em>Kolonoskopi</em></div>
    </div>
  </div>
  <div class="container">
    <div id="countdownCard" class="countdown-card">
      <div class="cc-label">Ä°ÅŸleme Kalan</div>
      <div class="cc-big"><span id="cdNumber">3</span><span class="cc-unit" id="cdUnit">gÃ¼n</span></div>
      <div class="cc-detail" id="cdDetail"></div>
    </div>
    <div id="phaseCard" class="phase-indicator">
      <div class="pi-phase" id="piPhase"></div>
      <div class="pi-title" id="piTitle"></div>
      <div class="pi-desc" id="piDesc"></div>
    </div>
    <div class="progress-bar"><div class="fill" id="progressFill" style="width:0%"></div></div>
    <div class="progress-labels"><span>BaÅŸlangÄ±Ã§</span><span id="progressPct">0%</span><span>Ä°ÅŸlem</span></div>
    <div id="todayTasks" class="today-tasks">
      <h3>BugÃ¼nkÃ¼ GÃ¶revler</h3>
      <div id="taskList"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• DIET â•â•â•â•â•â•â•â•â•â•â• -->
<div id="diet" class="screen">
  <div class="header">
    <div class="header-inner">
      <div class="header-title">Diyet Rehberi</div>
    </div>
  </div>
  <div class="container">
    <div class="day-tabs" id="dayTabs"></div>
    <div id="dietContent" class="diet-content"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• DRUG PROTOCOL â•â•â•â•â•â•â•â•â•â•â• -->
<div id="drug" class="screen">
  <div class="header">
    <div class="header-inner">
      <div class="header-title">Ä°laÃ§ ProtokolÃ¼</div>
    </div>
  </div>
  <div class="container" id="drugContent"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• STOOL TRACKER â•â•â•â•â•â•â•â•â•â•â• -->
<div id="stool" class="screen">
  <div class="header">
    <div class="header-inner">
      <div class="header-title">DÄ±ÅŸkÄ± Takibi</div>
    </div>
  </div>
  <div class="container">
    <div class="stool-intro">
      <h2>NasÄ±l GÃ¶rÃ¼nÃ¼yor?</h2>
      <p>HazÄ±rlÄ±k sÃ¼resince dÄ±ÅŸkÄ± gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼zÃ¼ takip edin. Hedef: berrak sÄ±vÄ±!</p>
    </div>
    <div class="stool-scale">
      <div class="stool-item" onclick="selectStool(1)">
        <div class="si-color" style="background:#4E342E;"></div>
        <div class="si-body"><h4>Tip 1 â€” Koyu Kahve, KatÄ±</h4><p>HenÃ¼z baÅŸlangÄ±Ã§ aÅŸamasÄ±</p></div>
      </div>
      <div class="stool-item" onclick="selectStool(2)">
        <div class="si-color" style="background:#8D6E63;"></div>
        <div class="si-body"><h4>Tip 2 â€” Kahverengi, BulanÄ±k</h4><p>Ä°laÃ§ etki etmeye baÅŸlÄ±yor</p></div>
      </div>
      <div class="stool-item" onclick="selectStool(3)">
        <div class="si-color" style="background:#BCAAA4;"></div>
        <div class="si-body"><h4>Tip 3 â€” AÃ§Ä±k Kahve, YarÄ± Berrak</h4><p>Ä°yi ilerliyorsunuz</p></div>
      </div>
      <div class="stool-item target-stool" onclick="selectStool(4)">
        <div class="si-color" style="background:#FDD835;"></div>
        <div class="si-body"><h4>Tip 4 â€” SarÄ±msÄ± Berrak</h4><p>Neredeyse hazÄ±rsÄ±nÄ±z!</p></div>
      </div>
      <div class="stool-item target-stool" onclick="selectStool(5)">
        <div class="si-color" style="background:#FFF9C4; border: 1px solid #eee;"></div>
        <div class="si-body"><h4>Tip 5 â€” Berrak / Renksiz</h4><p>MÃ¼kemmel temizlik!</p></div>
      </div>
    </div>
    <div id="stoolFeedback" class="stool-feedback"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• CHECKLIST & MEDS â•â•â•â•â•â•â•â•â•â•â• -->
<div id="checklist" class="screen">
  <div class="header">
    <div class="header-inner">
      <div class="header-title">Kontrol & Ä°laÃ§lar</div>
    </div>
  </div>
  <div class="container">
    <div class="med-warning">
      <h3>GLP-1 Agonistleri â€” Kritik UyarÄ±</h3>
      <p><strong>Ozempic, Wegovy, Mounjaro, Saxenda, Rybelsus, Trulicity</strong> â€” mide boÅŸalmasÄ±nÄ± yavaÅŸlatÄ±r.
      Ä°ÅŸlemden <strong>1â€“2 hafta Ã¶nce kesilmesi</strong> gerekebilir. Mutlaka doktorunuza danÄ±ÅŸÄ±n.</p>
    </div>

    <div class="med-card"><h4>Kan SulandÄ±rÄ±cÄ±lar</h4><p>Aspirin, Coumadin, Xarelto, Eliquis â€” <strong>mutlaka doktorunuza danÄ±ÅŸÄ±n.</strong> Kendi kararÄ±nÄ±zla kesmeyin.</p></div>
    <div class="med-card"><h4>Diyabet Ä°laÃ§larÄ±</h4><p>Ä°nsÃ¼lin doz ayarÄ± gerekir. Metformin iÅŸlem sabahÄ± kesilir. Berrak sÄ±vÄ± diyetinde kan ÅŸekerinizi sÄ±k kontrol edin.</p></div>
    <div class="med-card"><h4>Demir PreparatlarÄ±</h4><p><strong>5 gÃ¼n Ã¶nce kesin.</strong> DÄ±ÅŸkÄ±yÄ± siyahlaÅŸtÄ±rÄ±r ve gÃ¶rÃ¼ÅŸÃ¼ bozar.</p></div>
    <div class="med-card"><h4>Tansiyon Ä°laÃ§larÄ±</h4><p>Ä°ÅŸlem sabahÄ± <strong>az su ile alÄ±n</strong> (doktor onayÄ±yla).</p></div>

    <div class="checklist-card mt-16">
      <h3>HazÄ±rlÄ±k Kontrol Listesi</h3>
      <div id="checklistItems"></div>
    </div>

    <div class="emergency-card mt-16">
      <h3>Acil Durumlar â€” Hemen BaÅŸvurun</h3>
      <ul>
        <li>Åiddetli karÄ±n aÄŸrÄ±sÄ±</li>
        <li>38.5Â°C Ã¼zeri ateÅŸ</li>
        <li>Belirgin kanama veya ciddi kusma</li>
        <li>GÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± veya nefes darlÄ±ÄŸÄ±</li>
        <li>BilinÃ§ bulanÄ±klÄ±ÄŸÄ± veya baygÄ±nlÄ±k</li>
      </ul>
      <a href="tel:112" class="emergency-btn">112'yi Ara</a>
    </div>

    <div class="app-footer">
      Doktorunuzun size Ã¶zel talimatlarÄ±na uyunuz.<br>
      <strong>DoÃ§. Dr. Cem ÅimÅŸek</strong> â€” Gastroenteroloji Â· 2025
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="nav" id="mainNav">
  <div class="nav-inner">
    <button class="nav-btn active" onclick="go('dashboard')"><span class="ico">ğŸ </span>Ana Sayfa</button>
    <button class="nav-btn" onclick="go('diet')"><span class="ico">ğŸ¥—</span>Diyet</button>
    <button class="nav-btn" onclick="go('drug')"><span class="ico">ğŸ’Š</span>Ä°laÃ§</button>
    <button class="nav-btn" onclick="go('stool')"><span class="ico">ğŸ“Š</span>Takip</button>
    <button class="nav-btn" onclick="go('checklist')"><span class="ico">âœ…</span>Kontrol</button>
  </div>
</nav>

<script>
// â•â•â• STATE â•â•â•
let state = { date: null, time: null, drug: null, tasks: {}, checks: {}, stool: null };
const LS_KEY = 'kprep';

function save() { localStorage.setItem(LS_KEY, JSON.stringify(state)); }
function load() {
  try { const s = localStorage.getItem(LS_KEY); if (s) state = JSON.parse(s); } catch(e) {}
}

// â•â•â• SETUP â•â•â•
function selectTime(el) {
  document.querySelectorAll('.time-pill').forEach(e => e.classList.remove('selected'));
  el.classList.add('selected');
  state.time = el.dataset.time;
  checkReady();
}
function selectDrug(el) {
  document.querySelectorAll('.drug-card').forEach(e => e.classList.remove('selected'));
  el.classList.add('selected');
  state.drug = el.dataset.drug;
  checkReady();
}
function checkReady() {
  const d = document.getElementById('procDate').value;
  document.getElementById('startBtn').disabled = !(d && state.time && state.drug);
}
document.getElementById('procDate').addEventListener('change', checkReady);

function startApp() {
  state.date = document.getElementById('procDate').value;
  state.tasks = {};
  state.checks = {};
  save();
  document.getElementById('mainNav').classList.add('show');
  go('dashboard');
}

// â•â•â• NAVIGATION â•â•â•
function go(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => {
    const targets = { dashboard:'dashboard', diet:'diet', drug:'drug', stool:'stool', checklist:'checklist' };
    const label = b.textContent.trim();
    if (id === 'dashboard' && label.includes('Ana')) b.classList.add('active');
    if (id === 'diet' && label.includes('Diyet')) b.classList.add('active');
    if (id === 'drug' && label.includes('laÃ§')) b.classList.add('active');
    if (id === 'stool' && label.includes('Takip')) b.classList.add('active');
    if (id === 'checklist' && label.includes('Kontrol')) b.classList.add('active');
  });
  if (id === 'dashboard') renderDashboard();
  if (id === 'diet') renderDiet();
  if (id === 'drug') renderDrug();
  if (id === 'checklist') renderChecklist();
  window.scrollTo(0, 0);
}

// â•â•â• COUNTDOWN & DASHBOARD â•â•â•
function getDaysLeft() {
  const proc = new Date(state.date + 'T00:00:00');
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  return Math.ceil((proc - today) / 86400000);
}

function getPhase(daysLeft) {
  if (daysLeft > 3) return { phase: 'HAZIRLIK Ã–NCESÄ°', title: 'Normal Beslenme', desc: 'HenÃ¼z diyet deÄŸiÅŸikliÄŸine gerek yok. AlÄ±ÅŸveriÅŸ listenizi hazÄ±rlayÄ±n ve ilaÃ§larÄ±nÄ±zÄ± temin edin.', color: 'var(--green)' };
  if (daysLeft === 3) return { phase: '3 GÃœN Ã–NCE', title: 'DÃ¼ÅŸÃ¼k Lifli Diyet', desc: 'BugÃ¼nden itibaren dÃ¼ÅŸÃ¼k lifli diyete geÃ§in. Beyaz ekmek, pilav, tavuk, yumurta. Lifli gÄ±dalardan kaÃ§Ä±nÄ±n.', color: 'var(--orange)' };
  if (daysLeft === 2) return { phase: '2 GÃœN Ã–NCE', title: 'AzaltÄ±lmÄ±ÅŸ Diyet', desc: 'Daha hafif beslenin. Makarna, haÅŸlama patates, berrak Ã§orbalar. KÄ±zartma ve aÄŸÄ±r yemeklerden kaÃ§Ä±nÄ±n.', color: 'var(--orange)' };
  if (daysLeft === 1) return { phase: '1 GÃœN Ã–NCE', title: 'Berrak SÄ±vÄ± Diyeti + Ä°laÃ§', desc: 'Sadece berrak sÄ±vÄ±lar! KatÄ± gÄ±da yok. BugÃ¼n ilaÃ§ dozlarÄ±nÄ±zÄ± alacaksÄ±nÄ±z.', color: 'var(--bx)' };
  if (daysLeft === 0) return { phase: 'Ä°ÅLEM GÃœNÃœ', title: 'Kolonoskopi GÃ¼nÃ¼', desc: 'Ä°ÅŸlemden 2 saat Ã¶nce aÄŸÄ±zdan hiÃ§bir ÅŸey almayÄ±n. RefakatÃ§iniz ve evraklarÄ±nÄ±z hazÄ±r mÄ±?', color: 'var(--bx)' };
  return { phase: 'Ä°ÅLEM TAMAMLANDI', title: 'Ä°ÅŸlem SonrasÄ±', desc: 'Doktorunuzun talimatlarÄ±na uyun. Hafif beslenmeye baÅŸlayabilirsiniz.', color: 'var(--green)' };
}

function renderDashboard() {
  const dl = getDaysLeft();
  const phase = getPhase(dl);
  const cdNum = document.getElementById('cdNumber');
  const cdUnit = document.getElementById('cdUnit');
  const cdDetail = document.getElementById('cdDetail');

  if (dl > 0) {
    if (dl === 1) {
      cdNum.textContent = '1'; cdUnit.textContent = ' gÃ¼n';
    } else {
      cdNum.textContent = dl; cdUnit.textContent = ' gÃ¼n';
    }
    const procDate = new Date(state.date + 'T00:00:00');
    cdDetail.textContent = procDate.toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' }) + ' Â· ' + (state.time === 'morning' ? 'Sabah' : 'Ã–ÄŸleden Sonra');
  } else if (dl === 0) {
    cdNum.textContent = 'BugÃ¼n'; cdUnit.textContent = ''; cdDetail.textContent = 'Ä°ÅŸlem gÃ¼nÃ¼!';
    cdNum.style.fontSize = '36px';
  } else {
    cdNum.textContent = 'âœ“'; cdUnit.textContent = ''; cdDetail.textContent = 'Ä°ÅŸlem tamamlandÄ±';
  }

  document.getElementById('piPhase').textContent = phase.phase;
  document.getElementById('piTitle').textContent = phase.title;
  document.getElementById('piDesc').textContent = phase.desc;

  // Progress
  const totalDays = 4;
  const elapsed = Math.max(0, Math.min(totalDays, totalDays - dl));
  const pct = Math.round((elapsed / totalDays) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').textContent = pct + '%';

  // Tasks
  renderTasks(dl);
}

function renderTasks(daysLeft) {
  const list = document.getElementById('taskList');
  let tasks = [];

  if (daysLeft > 3) {
    tasks = [
      { id: 't_shop', title: 'AlÄ±ÅŸveriÅŸ yapÄ±n', desc: 'Ä°laÃ§, berrak sÄ±vÄ±lar, konfor malzemeleri', time: '' },
      { id: 't_meds', title: 'Ä°laÃ§larÄ±nÄ±zÄ± kontrol edin', desc: 'GLP-1, kan sulandÄ±rÄ±cÄ±, diyabet ilaÃ§larÄ±', time: '' },
    ];
  } else if (daysLeft === 3) {
    tasks = [
      { id: 't_diet3', title: 'DÃ¼ÅŸÃ¼k lifli diyete geÃ§in', desc: 'Beyaz ekmek, pilav, tavuk, yumurta', time: 'TÃ¼m gÃ¼n' },
      { id: 't_water3', title: '2.5 L sÄ±vÄ± iÃ§in', desc: 'Su, Ã§ay, sÃ¼zÃ¼lmÃ¼ÅŸ meyve suyu', time: '' },
      { id: 't_iron', title: 'Demir ilacÄ±nÄ± bÄ±rakÄ±n', desc: '(HenÃ¼z bÄ±rakmadÄ±ysanÄ±z)', time: '' },
    ];
  } else if (daysLeft === 2) {
    tasks = [
      { id: 't_diet2', title: 'Hafif yemeklere geÃ§in', desc: 'Makarna, patates pÃ¼resi, berrak Ã§orba', time: 'TÃ¼m gÃ¼n' },
      { id: 't_water2', title: '3 L sÄ±vÄ± iÃ§in', desc: 'SÄ±vÄ± tÃ¼ketimini artÄ±rÄ±n', time: '' },
    ];
  } else if (daysLeft === 1) {
    tasks = getDayBeforeTasks();
  } else if (daysLeft === 0) {
    tasks = getProcDayTasks();
  }

  list.innerHTML = tasks.map(t => `
    <div class="task-item" onclick="toggleTask('${t.id}')">
      <div class="task-check ${state.tasks[t.id] ? 'done' : ''}">${state.tasks[t.id] ? 'âœ“' : ''}</div>
      <div class="task-body"><h4>${t.title}</h4><p>${t.desc}</p></div>
      ${t.time ? `<div class="task-time">${t.time}</div>` : ''}
    </div>
  `).join('');
}

function getDayBeforeTasks() {
  const d = state.drug;
  const m = state.time === 'morning';
  let tasks = [
    { id: 't_clear', title: 'Sadece berrak sÄ±vÄ±', desc: 'KatÄ± gÄ±da kesinlikle yasak!', time: 'TÃ¼m gÃ¼n' },
    { id: 't_water1', title: 'En az 3â€“4 L berrak sÄ±vÄ±', desc: 'Ã‡ay, elma suyu, tavuk suyu, su', time: '' },
  ];
  if (d === 'peg2') {
    tasks.push({ id: 't_dose1', title: '1. Doz â€” 1L Pegdin', desc: 'Her 15 dk\'da 250 ml. 1â€“2 saatte bitirin.', time: m ? '18:00' : '18:00' });
    tasks.push({ id: 't_extra1', title: '500 ml ek berrak sÄ±vÄ±', desc: 'Ä°laÃ§ sonrasÄ±', time: m ? '20:00' : '20:00' });
  } else if (d === 'picoprep') {
    tasks.push({ id: 't_dose1', title: '1. SaÅŸe Picoprep', desc: '150 ml soÄŸuk su ile iÃ§in.', time: m ? '16:00' : '17:00' });
    tasks.push({ id: 't_extra1', title: '5 bardak berrak sÄ±vÄ± (1.25 L)', desc: 'SaÅŸe sonrasÄ± 5 saatte', time: '' });
  } else if (d === 'fortrans') {
    tasks.push({ id: 't_dose1', title: '1. Doz â€” 2L Fortrans', desc: 'Her 15 dk\'da 250 ml. 2 saatte bitirin.', time: m ? '17:00' : '18:00' });
    tasks.push({ id: 't_extra1', title: '1 L ek berrak sÄ±vÄ±', desc: 'Ä°laÃ§ sonrasÄ±', time: '' });
  } else if (d === 'phospho') {
    tasks.push({ id: 't_dose1', title: '1. Doz â€” 45 ml Fleet Fosfo-Soda', desc: 'Â½ bardak su ile iÃ§in + en az 3 bardak sÄ±vÄ±', time: m ? '18:00' : '18:00' });
  }
  return tasks;
}

function getProcDayTasks() {
  const d = state.drug;
  const m = state.time === 'morning';
  let tasks = [];
  if (d === 'peg2') {
    tasks.push({ id: 't_dose2', title: '2. Doz â€” 1L Pegdin', desc: 'Ä°ÅŸlemden 5 saat Ã¶nce baÅŸlayÄ±n.', time: m ? '03:00' : '07:00' });
    tasks.push({ id: 't_extra2', title: '500 ml ek berrak sÄ±vÄ±', desc: '2. doz sonrasÄ±', time: '' });
  } else if (d === 'picoprep') {
    tasks.push({ id: 't_dose2', title: '2. SaÅŸe Picoprep', desc: '150 ml su + en az 3 bardak sÄ±vÄ±', time: m ? '03:00' : '06:00' });
  } else if (d === 'fortrans') {
    tasks.push({ id: 't_dose2', title: '2. Doz â€” 2L Fortrans', desc: 'Ä°ÅŸlemden 5 saat Ã¶nce.', time: m ? '03:00' : '07:00' });
  } else if (d === 'phospho') {
    tasks.push({ id: 't_dose2', title: '2. Doz â€” 45 ml Fleet Fosfo-Soda', desc: 'Â½ bardak su + 3 bardak sÄ±vÄ±', time: m ? '03:00' : '07:00' });
  }
  tasks.push({ id: 't_stop', title: 'AÄIZDAN HÄ°Ã‡BÄ°R ÅEY', desc: 'Ä°ÅŸlemden 2 saat Ã¶nce durmalÄ±sÄ±nÄ±z', time: 'NPO' });
  tasks.push({ id: 't_companion', title: 'RefakatÃ§i hazÄ±r', desc: 'RefakatÃ§isiz iÅŸlem yapÄ±lmaz!', time: '' });
  tasks.push({ id: 't_docs', title: 'EvraklarÄ± hazÄ±rlayÄ±n', desc: 'Kimlik, sigorta, tetkikler, ilaÃ§ listesi', time: '' });
  return tasks;
}

function toggleTask(id) {
  state.tasks[id] = !state.tasks[id];
  save();
  renderDashboard();
}

// â•â•â• DIET â•â•â•
const dietData = {
  3: {
    title: '3 GÃ¼n Ã–nce â€” DÃ¼ÅŸÃ¼k Lifli Diyet',
    cards: [
      {
        title: 'TahÄ±llar',
        yes: ['Beyaz ekmek, pide, yufka', 'Beyaz pirinÃ§ pilavÄ±', 'Makarna (sade)', 'BiskÃ¼vi, kraker, galeta'],
        no: ['Tam buÄŸday ekmek', 'Bulgur, esmer pirinÃ§', 'Yulaf, mÄ±sÄ±r, Ã§avdar', 'Kepekli Ã¼rÃ¼nler'],
      },
      {
        title: 'Protein',
        yes: ['Tavuk (derisi soyulmuÅŸ)', 'Izgara balÄ±k', 'Yumurta (haÅŸlama, omlet)', 'YaÄŸsÄ±z kÃ¶fte, hindi'],
        no: ['Kuru baklagiller', 'Mercimek, nohut, fasulye', 'KÄ±rmÄ±zÄ± et (sert)', 'PastÄ±rma, sucuk, salam'],
      },
      {
        title: 'Sebze & Meyve',
        yes: ['Kabuksuz piÅŸmiÅŸ patates', 'HaÅŸlama havuÃ§, kabak', 'PiÅŸmiÅŸ patlÄ±can', 'Muz, kavun, karpuz'],
        no: ['Ã‡iÄŸ sebzeler, salata', 'Brokoli, lahana, Ä±spanak', 'Kabuklu meyveler', 'Kuru meyve, nar, Ã§ilek'],
      },
      {
        title: 'Ä°Ã§ecek',
        yes: ['Su (bol!)', 'Sade Ã§ay, bitki Ã§aylarÄ±', 'SÃ¼zÃ¼lmÃ¼ÅŸ meyve suyu', 'Filtre kahve (sade)'],
        no: ['Alkol', 'PosalÄ± meyve sularÄ±', 'Enerji iÃ§ecekleri', 'SÃ¼t (fazla miktarda)'],
      }
    ],
    meals: {
      kahvalti: ['Beyaz ekmek + yumurta', 'Beyaz peynir + bal', 'Sade Ã§ay'],
      ogle: ['Beyaz pirinÃ§ pilavÄ±', 'Izgara tavuk', 'HaÅŸlama havuÃ§'],
      aksam: ['Makarna (sade sos)', 'veya Izgara balÄ±k', 'Patates pÃ¼resi'],
    }
  },
  2: {
    title: '2 GÃ¼n Ã–nce â€” AzaltÄ±lmÄ±ÅŸ Diyet',
    cards: [
      {
        title: 'TÃ¼ketebilecekleriniz',
        yes: ['Berrak tavuk / et suyu', 'Makarna (sade, az)', 'HaÅŸlama patates', 'Beyaz pirinÃ§ (az)', 'Yumurta (haÅŸlama)', 'Galeta, kraker', 'Bal, pekmez (az)'],
        no: ['KÄ±zartmalar', 'YaÄŸlÄ± yemekler', 'Salata, Ã§iÄŸ sebzeler', 'Baklagiller', 'KuruyemiÅŸ', 'Lifli her ÅŸey'],
      },
    ],
    meals: {
      kahvalti: ['Galeta + bal', 'HaÅŸlama yumurta', 'Ã‡ay'],
      ogle: ['Berrak tavuk suyu', 'Az pirinÃ§', 'Su, Ã§ay'],
      aksam: ['HaÅŸlama patates', 'Berrak et suyu', 'Bol su'],
    }
  },
  1: {
    title: '1 GÃ¼n Ã–nce â€” Berrak SÄ±vÄ± Diyeti',
    cards: [
      {
        title: 'Ä°Ã§ebilecekleriniz',
        yes: ['Su (sÄ±nÄ±rsÄ±z!)', 'Sade Ã§ay, bitki Ã§aylarÄ±', 'SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu', 'Beyaz Ã¼zÃ¼m suyu', 'Berrak tavuk/et suyu', 'Bal, ÅŸeker (Ã§ay/suya)', 'Jelatin (sarÄ±/yeÅŸil)', 'Berrak limonata'],
        no: ['HER TÃœRLÃœ KATI GIDA', 'SÃ¼t, yoÄŸurt, ayran', 'KÄ±rmÄ±zÄ±/mor/mavi sÄ±vÄ±lar', 'BulanÄ±k meyve sularÄ±', 'Alkol', 'SÃ¼tlÃ¼/kremalÄ± kahve', 'Smoothie, dondurma'],
      },
    ],
    meals: {
      kahvalti: ['2 bardak su', 'Ã‡ay + bal', 'Elma suyu'],
      ogle: ['Berrak tavuk suyu', 'ÃœzÃ¼m suyu', 'Jelatin tatlÄ±sÄ±'],
      aksam: ['Berrak et suyu', 'Ã‡ay + bal', 'Bol su, limonata'],
    }
  },
  0: {
    title: 'Ä°ÅŸlem GÃ¼nÃ¼',
    cards: [
      {
        title: 'NPO KuralÄ±',
        yes: ['2. doz ilacÄ±nÄ±zÄ± zamanÄ±nda alÄ±n', 'Ä°laÃ§lar arasÄ± berrak sÄ±vÄ± iÃ§in', 'DÃ¼zenli ilaÃ§larÄ± az su ile alÄ±n'],
        no: ['Ä°ÅŸlemden 2 saat Ã¶nce HÄ°Ã‡BÄ°R ÅEY', 'KatÄ± gÄ±da', 'SakÄ±z bile Ã§iÄŸnemeyin'],
      },
    ],
    meals: null
  }
};

function renderDiet() {
  const dl = getDaysLeft();
  const tabs = document.getElementById('dayTabs');
  const content = document.getElementById('dietContent');

  const days = [3, 2, 1, 0];
  let activeDay = days.includes(dl) ? dl : (dl > 3 ? 3 : 0);

  tabs.innerHTML = days.map(d => `
    <div class="day-tab ${d === activeDay ? 'active' : ''}" onclick="showDietDay(${d})">${
      d === 0 ? 'Ä°ÅŸlem GÃ¼nÃ¼' : d + ' GÃ¼n Ã–nce'
    }</div>
  `).join('');

  showDietDay(activeDay);
}

function showDietDay(day) {
  document.querySelectorAll('.day-tab').forEach((t, i) => {
    t.classList.toggle('active', [3,2,1,0][i] === day);
  });
  const data = dietData[day];
  const content = document.getElementById('dietContent');
  let html = '';

  data.cards.forEach(card => {
    html += `<div class="food-card"><h3>${card.title}</h3><div class="food-grid">`;
    card.yes.forEach(f => html += `<div class="food-item yes"><span class="fi-icon">âœ“</span> ${f}</div>`);
    card.no.forEach(f => html += `<div class="food-item no"><span class="fi-icon">âœ—</span> ${f}</div>`);
    html += '</div>';
    if (data.meals) {
      html += `<div class="meal-plan">
        <div class="meal-slot"><h5>KahvaltÄ±</h5>${data.meals.kahvalti.map(m => `<p>${m}</p>`).join('')}</div>
        <div class="meal-slot"><h5>Ã–ÄŸle</h5>${data.meals.ogle.map(m => `<p>${m}</p>`).join('')}</div>
        <div class="meal-slot"><h5>AkÅŸam</h5>${data.meals.aksam.map(m => `<p>${m}</p>`).join('')}</div>
      </div>`;
    }
    html += '</div>';
  });

  content.innerHTML = html;
}

// â•â•â• DRUG PROTOCOL â•â•â•
const drugInfo = {
  peg2: { name: 'Pegdin', gen: 'PEG + Askorbik Asit Â· 2 Litre Â· Oral SolÃ¼syon', icon: 'ğŸ’Š' },
  picoprep: { name: 'Picoprep', gen: 'Sodyum PikosÃ¼lfat + Magnezyum Sitrat Â· 2 SaÅŸe Â· Turuncu Aroma', icon: 'ğŸ’Š' },
  fortrans: { name: 'Fortrans', gen: 'Makrogol 4000 (PEG) Â· 4 Litre Â· Oral SolÃ¼syon', icon: 'ğŸ’Š' },
  phospho: { name: 'Fleet Fosfo-Soda', gen: 'Sodyum Fosfat Oral SolÃ¼syon Â· 2 Ã— 45 ml', icon: 'ğŸ’Š' },
};

function renderDrug() {
  const d = state.drug;
  const m = state.time === 'morning';
  const info = drugInfo[d];
  const el = document.getElementById('drugContent');

  let html = `
    <div class="protocol-header">
      <div class="ph-icon">${info.icon}</div>
      <div><div class="ph-name">${info.name}</div><div class="ph-gen">${info.gen}</div></div>
    </div>
  `;

  if (d === 'peg2') {
    html += `
      <p style="font-size:13px;color:var(--body);margin:8px 0;line-height:1.6;">
        SolÃ¼syonu ambalaj talimatlarÄ±na gÃ¶re hazÄ±rlayÄ±n. <strong>BuzdolabÄ±nda soÄŸutmak</strong> tadÄ±nÄ± iyileÅŸtirir.
      </p>
      <div class="dose-card">
        <div class="dc-time">1. DOZ â€” Ã–nceki GÃ¼n ${m ? '18:00â€“20:00' : '18:00â€“20:00'}</div>
        <div class="dc-title">1 Litre Pegdin</div>
        <div class="dc-desc">Her 10â€“15 dakikada 250 ml. Toplam 1â€“2 saatte bitirin.<br><strong>+ 500 ml berrak sÄ±vÄ±</strong></div>
        <div class="dc-tip">Ä°pucu: SoÄŸutun, pipet ile iÃ§in. Naneli ÅŸeker koklatÄ±n.</div>
      </div>
      <div class="dose-card">
        <div class="dc-time">2. DOZ â€” Ä°ÅŸlem GÃ¼nÃ¼ ${m ? '03:00â€“04:00' : '07:00â€“08:00'}</div>
        <div class="dc-title">1 Litre Pegdin</div>
        <div class="dc-desc">AynÄ± ÅŸekilde 1â€“2 saatte bitirin.<br><strong>+ 500 ml berrak sÄ±vÄ±</strong></div>
        <div class="dc-tip">${m ? 'Alarm kurmayÄ± unutmayÄ±n! Erken kalkmanÄ±z gerekecek.' : 'Rahat bir sabah. Ama gecikmeyin!'}</div>
      </div>
    `;
  } else if (d === 'picoprep') {
    html += `
      <p style="font-size:13px;color:var(--body);margin:8px 0;line-height:1.6;">
        Her saÅŸeyi <strong>150 ml soÄŸuk su</strong> iÃ§inde eritin. 2â€“3 dk karÄ±ÅŸtÄ±rÄ±n. KÃ¶pÃ¼rme durduÄŸunda iÃ§in.
      </p>
      <div class="dose-card">
        <div class="dc-time">1. SAÅE â€” Ã–nceki GÃ¼n ${m ? '16:00â€“17:00' : '17:00â€“18:00'}</div>
        <div class="dc-title">Picoprep 1. SaÅŸe</div>
        <div class="dc-desc">150 ml su ile iÃ§in. ArdÄ±ndan 5 saatte <strong>en az 5 bardak (1.25 L) berrak sÄ±vÄ±</strong> tÃ¼ketin.</div>
        <div class="dc-tip">Turuncu aromasÄ± oldukÃ§a kabul edilebilir. SoÄŸutabilirsiniz.</div>
      </div>
      <div class="dose-card">
        <div class="dc-time">2. SAÅE â€” Ä°ÅŸlem GÃ¼nÃ¼ ${m ? '03:00â€“04:00' : '06:00â€“07:00'}</div>
        <div class="dc-title">Picoprep 2. SaÅŸe</div>
        <div class="dc-desc">150 ml su ile iÃ§in. <strong>+ En az 3 bardak (750 ml) berrak sÄ±vÄ±.</strong></div>
        <div class="dc-tip">${m ? 'Alarm kurun! Erken kalkÄ±ÅŸ gerekli.' : 'Sabah sakin bir tempoda.'}</div>
      </div>
    `;
  } else if (d === 'fortrans') {
    html += `
      <p style="font-size:13px;color:var(--body);margin:8px 0;line-height:1.6;">
        4 poÅŸeti 4 litre suya karÄ±ÅŸtÄ±rÄ±n. <strong>BuzdolabÄ±nda soÄŸutun.</strong> Limon suyu eklenebilir.
      </p>
      <div class="dose-card">
        <div class="dc-time">1. DOZ â€” Ã–nceki GÃ¼n ${m ? '17:00â€“19:00' : '18:00â€“20:00'}</div>
        <div class="dc-title">2 Litre Fortrans</div>
        <div class="dc-desc">Her 15 dk'da 250 ml. 2 saatte bitirin.<br><strong>+ 1 L ek berrak sÄ±vÄ±</strong></div>
        <div class="dc-tip">Hacim fazla â€” sabÄ±rlÄ± olun. Mola verin ama bÄ±rakmayÄ±n.</div>
      </div>
      <div class="dose-card">
        <div class="dc-time">2. DOZ â€” Ä°ÅŸlem GÃ¼nÃ¼ ${m ? '03:00â€“05:00' : '07:00â€“09:00'}</div>
        <div class="dc-title">2 Litre Fortrans</div>
        <div class="dc-desc">AynÄ± ÅŸekilde 2 saatte bitirin.<br><strong>+ 500 ml berrak sÄ±vÄ±</strong></div>
        <div class="dc-tip">${m ? 'Gece/sabah erken kalkÄ±ÅŸ gerekli. Alarm kurun!' : 'Sabah sakin tempoda.'}</div>
      </div>
    `;
  } else if (d === 'phospho') {
    html += `
      <p style="font-size:13px;color:var(--body);margin:8px 0;line-height:1.6;">
        Her dozu yarÄ±m bardak su ile iÃ§in. Ã‡ok tuzlu tadÄ± vardÄ±r. <strong>Bol berrak sÄ±vÄ± ile takip edin.</strong>
      </p>
      <div class="dose-card">
        <div class="dc-time">1. DOZ â€” Ã–nceki GÃ¼n ${m ? '18:00' : '18:00'}</div>
        <div class="dc-title">45 ml Fleet Fosfo-Soda</div>
        <div class="dc-desc">YarÄ±m bardak soÄŸuk su ile iÃ§in. <strong>En az 3 bardak berrak sÄ±vÄ±</strong> takip edin.</div>
        <div class="dc-tip">Tuzlu tadÄ± keskin olabilir â€” limonata ile yudumlamayÄ± deneyin.</div>
      </div>
      <div class="dose-card">
        <div class="dc-time">2. DOZ â€” Ä°ÅŸlem GÃ¼nÃ¼ ${m ? '03:00' : '07:00'}</div>
        <div class="dc-title">45 ml Fleet Fosfo-Soda</div>
        <div class="dc-desc">YarÄ±m bardak su ile iÃ§in. <strong>En az 3 bardak berrak sÄ±vÄ±.</strong></div>
        <div class="dc-tip">${m ? 'Erken alarm kurun!' : 'Sabah sakin bir tempoda.'}</div>
      </div>
      <div class="adjuvant-card">
        <h4>Ã–nemli UyarÄ± â€” BÃ¶brek</h4>
        <p>Sodyum fosfat bÃ¶brek fonksiyonlarÄ±nÄ± etkileyebilir. <strong>65 yaÅŸ Ã¼stÃ¼, bÃ¶brek hastasÄ± veya kalp hastasÄ±</strong> iseniz doktorunuz farklÄ± bir ilaÃ§ tercih edebilir.</p>
      </div>
    `;
  }

  html += `
    <div class="stop-banner">
      â›” Ä°ÅLEMDEN 2 SAAT Ã–NCE â€” AÄIZDAN HÄ°Ã‡BÄ°R ÅEY<br>
      <span style="font-size:12px;font-weight:400;">(Su dahil. DÃ¼zenli ilaÃ§lar az su ile alÄ±nabilir.)</span>
    </div>
    <div class="adjuvant-card">
      <h4>Adjuvan â€” Bisacodyl (Dulcolax)</h4>
      <p>Doktorunuz Ã¶nerdiÄŸi takdirde, 1. dozdan <strong>1 saat Ã¶nce 10 mg bisacodyl tablet</strong> alÄ±nabilir. Kronik kabÄ±zlÄ±k, diyabet veya opioid kullanÄ±mÄ±nda temizlik kalitesini artÄ±rÄ±r.</p>
    </div>
    <div class="adjuvant-card">
      <h4>Kurtarma â€” Lavman (Fleet Enema)</h4>
      <p>HazÄ±rlÄ±k sonrasÄ± dÄ±ÅŸkÄ± hÃ¢lÃ¢ berrak deÄŸilse, doktorunuz sodyum fosfat lavman Ã¶nerebilir. Ä°ÅŸlemden 2â€“3 saat Ã¶nce uygulanÄ±r. <strong>Kendi kararÄ±nÄ±zla uygulamayÄ±n.</strong></p>
    </div>
    <div class="comfort-tips">
      <h3>Konfor Ä°puÃ§larÄ±</h3>
      <div class="tip-item"><span class="ti-icon">ğŸ§Š</span>Ä°laÃ§larÄ± buzdolabÄ±nda soÄŸutun â€” tadÄ± Ã§ok daha kolay</div>
      <div class="tip-item"><span class="ti-icon">ğŸ¥¤</span>Pipet ile iÃ§in â€” tad papillalarÄ±nÄ± atlatÄ±r</div>
      <div class="tip-item"><span class="ti-icon">ğŸ¬</span>Yudumlar arasÄ±nda naneli ÅŸeker veya limon koklatÄ±n</div>
      <div class="tip-item"><span class="ti-icon">ğŸš¶</span>Ä°laÃ§ sonrasÄ± evde hafif yÃ¼rÃ¼yÃ¼ÅŸ â€” baÄŸÄ±rsaÄŸÄ± uyarÄ±r</div>
      <div class="tip-item"><span class="ti-icon">ğŸ§´</span>AnÃ¼s Ã§evresine Ã¶nceden vazelin / bebek kremi sÃ¼rÃ¼n</div>
      <div class="tip-item"><span class="ti-icon">ğŸ§»</span>Islak mendil kullanÄ±n â€” tuvalet kaÄŸÄ±dÄ±ndan daha yumuÅŸak</div>
      <div class="tip-item"><span class="ti-icon">ğŸ‘–</span>Lastikli pantolon giyin â€” dÃ¼ÄŸmeli/kemerli deÄŸil</div>
      <div class="tip-item"><span class="ti-icon">ğŸ“±</span>Telefon, tablet, ÅŸarj kablosu â€” banyoda vakit geÃ§ireceksiniz</div>
    </div>
  `;

  el.innerHTML = html;
}

// â•â•â• STOOL TRACKER â•â•â•
function selectStool(level) {
  state.stool = level;
  save();
  document.querySelectorAll('.stool-item').forEach((el, i) => {
    el.classList.toggle('selected', i + 1 === level);
  });
  const fb = document.getElementById('stoolFeedback');
  fb.classList.add('show');
  const msgs = {
    1: { emoji: 'â³', msg: 'HenÃ¼z baÅŸlangÄ±Ã§ta', detail: 'Ä°laÃ§ henÃ¼z tam etki etmemiÅŸ. Berrak sÄ±vÄ± tÃ¼ketmeye devam edin ve ilacÄ±n tamamÄ±nÄ± bitirin.' },
    2: { emoji: 'ğŸ“ˆ', msg: 'Ä°lerliyorsunuz', detail: 'Ä°laÃ§ etki etmeye baÅŸlÄ±yor. Bol sÄ±vÄ± tÃ¼ketmeye devam edin. YÃ¼rÃ¼yÃ¼ÅŸ yapÄ±n.' },
    3: { emoji: 'ğŸ‘', msg: 'Ä°yi gidiyorsunuz!', detail: 'Temizlik ilerliyor. SÄ±vÄ± almaya devam edin. 2. dozu zamanÄ±nda alÄ±n.' },
    4: { emoji: 'ğŸ¯', msg: 'Neredeyse hazÄ±rsÄ±nÄ±z!', detail: 'Harika! Berrak sarÄ±msÄ± gÃ¶rÃ¼nÃ¼m iyi temizlik demek. SÄ±vÄ± tÃ¼ketmeye devam edin.' },
    5: { emoji: 'ğŸ†', msg: 'MÃ¼kemmel temizlik!', detail: 'Tam hedef! Berrak ve renksiz â€” kolonoskopi iÃ§in ideal hazÄ±rlÄ±k. ArtÄ±k sÄ±vÄ± almayÄ± kesebilirsiniz (NPO saati geldiÄŸinde).' },
  };
  const m = msgs[level];
  fb.innerHTML = `<div class="sf-emoji">${m.emoji}</div><div class="sf-msg">${m.msg}</div><div class="sf-detail">${m.detail}</div>`;
}

// â•â•â• CHECKLIST â•â•â•
const checkItems = [
  'HazÄ±rlÄ±k ilacÄ±mÄ± temin ettim',
  'Ä°laÃ§ kesme/doz ayarÄ± iÃ§in doktora danÄ±ÅŸtÄ±m',
  '3 gÃ¼n Ã¶nce dÃ¼ÅŸÃ¼k lifli diyete geÃ§tim',
  '2 gÃ¼n Ã¶nce daha da hafiflettim',
  '1 gÃ¼n Ã¶nce berrak sÄ±vÄ± diyetine geÃ§tim',
  '1. doz ilacÄ± zamanÄ±nda aldÄ±m',
  'Yeterli berrak sÄ±vÄ± tÃ¼kettim (3+ L)',
  '2. doz ilacÄ± zamanÄ±nda aldÄ±m',
  'DÄ±ÅŸkÄ±m berrak sÄ±vÄ± haline geldi',
  'Ä°ÅŸlemden 2 saat Ã¶nce durdum',
  'Kimlik ve sigorta kartÄ±mÄ± hazÄ±rladÄ±m',
  'Tetkik sonuÃ§larÄ±mÄ± hazÄ±rladÄ±m',
  'Ä°laÃ§ listemi hazÄ±rladÄ±m',
  'Rahat kÄ±yafet giydim',
  'RefakatÃ§im hazÄ±r',
];

function renderChecklist() {
  const el = document.getElementById('checklistItems');
  el.innerHTML = checkItems.map((item, i) => `
    <div class="cl-item ${state.checks[i] ? 'checked' : ''}" onclick="toggleCheck(${i})">
      <div class="cl-box">${state.checks[i] ? 'âœ“' : ''}</div>
      <div class="cl-text">${item}</div>
    </div>
  `).join('');
}

function toggleCheck(i) {
  state.checks[i] = !state.checks[i];
  save();
  renderChecklist();
}

// â•â•â• INIT â•â•â•
load();
if (state.date) {
  document.getElementById('mainNav').classList.add('show');
  go('dashboard');
}

// Set min date to today
const today = new Date();
const yyyy = today.getFullYear();
const mm = String(today.getMonth() + 1).padStart(2, '0');
const dd = String(today.getDate()).padStart(2, '0');
document.getElementById('procDate').min = `${yyyy}-${mm}-${dd}`;
</script>
</body>
</html>
